{"version":3,"file":"static/js/711.b61b3265.chunk.js","mappings":"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","sources":["BigBucketApp.jsx","bucket-lib/utils.js","data/objectivesData.jsx","utils.js"],"sourcesContent":["import React, { useMemo, useState } from \"react\";\r\nimport * as d3 from \"d3\";\r\nimport { useEffect, useRef } from \"react\";\r\nimport { ticksExact } from \"./bucket-lib/utils\";\r\nimport {\r\n  DELIV_KEY_STRING,\r\n  SCENARIO_KEY_STRING,\r\n  objectivesData,\r\n} from \"./data/objectivesData\";\r\n\r\nimport { bucketPath } from \"./bucket-lib/utils\";\r\n\r\nconst LEVELS = 10;\r\nconst LINE_WIDTH = 3;\r\nconst DEFAULT_OBJECTIVE_IDX = 0;\r\n\r\nexport default function BigBucketApp({ width = 600, height = 600 }) {\r\n  const { current: objectiveIDs } = useRef(Object.keys(objectivesData));\r\n  const [curObjectiveIdx, setCurObjectiveIdx] = useState(DEFAULT_OBJECTIVE_IDX);\r\n\r\n  const bucketSvgSelector = useRef();\r\n\r\n  const orderedScenIDs = useMemo(\r\n    () => criteriaSort(\"median\", objectivesData, objectiveIDs[curObjectiveIdx]),\r\n    [curObjectiveIdx]\r\n  );\r\n\r\n  const curPercentileScens = useMemo(() => {\r\n    return Array.from(orderedScenIDs).filter((_, i) =>\r\n      ticksExact(0, 0.9, 20)\r\n        .map((d) => Math.floor((d + 0.05) * orderedScenIDs.length))\r\n        .includes(i)\r\n    );\r\n  }, [orderedScenIDs]);\r\n\r\n  const waterLevels = useMemo(\r\n    () =>\r\n      ticksExact(0, 1, LEVELS + 1).map((d) =>\r\n        curPercentileScens.map((s) =>\r\n          createInterps(objectiveIDs[curObjectiveIdx], s)(d)\r\n        )\r\n      ),\r\n    [curPercentileScens, curObjectiveIdx]\r\n  );\r\n\r\n  const innerWidth = width - LINE_WIDTH * 2;\r\n  const innerHeight = height - LINE_WIDTH;\r\n\r\n  const x = d3.scaleLinear().range([0, innerWidth]);\r\n  const y = d3.scaleLinear().range([innerHeight, 0]);\r\n\r\n  useEffect(() => {\r\n    const svgContainer = bucketSvgSelector.current\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-container\")\r\n      .attr(\"transform\", `translate(${LINE_WIDTH}, ${LINE_WIDTH / 2})`);\r\n\r\n    svgContainer\r\n      .append(\"defs\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask\")\r\n      .append(\"path\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight));\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"clip-path\", `url(#bucket-mask)`);\r\n\r\n    svgContainer\r\n      .append(\"path\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight).split(\"z\")[0])\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    bucketSvgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\"path\")\r\n      .data(waterLevels)\r\n      .join(\"path\")\r\n      .attr(\"fill\", (_, i) => d3.interpolateBlues(i / waterLevels.length))\r\n      .transition()\r\n      .duration(500)\r\n      .attr(\"d\", (dd) => {\r\n        const ddd = [dd[0]];\r\n\r\n        for (let i = 1; i < dd.length; i++) {\r\n          ddd.push(dd[i - 1]);\r\n          ddd.push(dd[i]);\r\n        }\r\n\r\n        return (\r\n          d3\r\n            .area()\r\n            // .curve(d3.curveBasis)\r\n            .x(function (_, i) {\r\n              return x(Math.ceil(i / 2) / (dd.length - 1));\r\n            })\r\n            .y1((d) => y(d))\r\n            .y0(() => y(0))(ddd)\r\n        );\r\n      });\r\n  }, [waterLevels]);\r\n\r\n  return (\r\n    <div className=\"big-bucket-wrapper\">\r\n      <select\r\n        value={curObjectiveIdx}\r\n        onChange={(e) => setCurObjectiveIdx(parseInt(e.target.value))}\r\n      >\r\n        {objectiveIDs.map((objectiveID, i) => (\r\n          <option name={i} value={i}>\r\n            {objectiveID}\r\n          </option>\r\n        ))}\r\n      </select>\r\n      <svg ref={(e) => void (bucketSvgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction createInterps(name, curScen) {\r\n  const delivs =\r\n    objectivesData[name][SCENARIO_KEY_STRING][curScen][DELIV_KEY_STRING];\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / 1200) || 0))\r\n    .clamp(true);\r\n}\r\n\r\nfunction criteriaSort(criteria, data, objective) {\r\n  if (criteria === \"median\") {\r\n    return Object.keys(data[objective][SCENARIO_KEY_STRING]).sort(\r\n      (a, b) =>\r\n        d3.mean(data[objective][SCENARIO_KEY_STRING][a][DELIV_KEY_STRING]) -\r\n        d3.mean(data[objective][SCENARIO_KEY_STRING][b][DELIV_KEY_STRING])\r\n    );\r\n  }\r\n  if (criteria === \"deliveries\") {\r\n    return Object.keys(data[objective][SCENARIO_KEY_STRING]).sort(\r\n      (a, b) =>\r\n        d3.max(data[objective][SCENARIO_KEY_STRING][a][DELIV_KEY_STRING]) -\r\n        d3.max(data[objective][SCENARIO_KEY_STRING][b][DELIV_KEY_STRING])\r\n    );\r\n  }\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useRef } from \"react\";\r\n\r\nexport function ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nexport function bucketPath(width, height, filled = 1.0, taper = 0.8) {\r\n  let bottomRight = width * taper + (width * (1 - taper)) / 2,\r\n    bottomLeft = (width * (1 - taper)) / 2;\r\n  let data = [\r\n    {\r\n      x: d3.interpolate(bottomRight, width)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n    { x: bottomRight, y: height },\r\n    { x: bottomLeft, y: height },\r\n    {\r\n      x: d3.interpolate(bottomLeft, 0)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n  ];\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d.x;\r\n    })\r\n    .y(function (d) {\r\n      return d.y;\r\n    });\r\n  return lineFunc(data) + \"z\";\r\n}\r\n\r\nexport function quantileBins(numericBins, unitsPerQuantile, maxQuantiles) {\r\n  let quantileBins = numericBins.map((bin) =>\r\n    Math.round(bin.length / unitsPerQuantile)\r\n  );\r\n  let sum = d3.sum(quantileBins);\r\n\r\n  while (sum > maxQuantiles) {\r\n    quantileBins[\r\n      d3.minIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : Infinity\r\n      )\r\n    ] -= 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  while (sum < maxQuantiles) {\r\n    quantileBins[\r\n      d3.maxIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : -Infinity\r\n      )\r\n    ] += 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  return quantileBins;\r\n}\r\n\r\n// https://www.developerway.com/posts/implementing-advanced-use-previous-hook\r\nexport function usePrevious(value, isEqualFunc) {\r\n  // initialise the ref with previous and current values\r\n  const ref = useRef({\r\n    value: value,\r\n    prev: null,\r\n  });\r\n\r\n  const current = ref.current.value;\r\n\r\n  // if the value passed into hook doesn't match what we store as \"current\"\r\n  // move the \"current\" to the \"previous\"\r\n  // and store the passed value as \"current\"\r\n  if (isEqualFunc ? !isEqualFunc(value, current) : value !== current) {\r\n    ref.current = {\r\n      value: value,\r\n      prev: current,\r\n    };\r\n  }\r\n\r\n  // return the previous value only\r\n  return ref.current.prev;\r\n}\r\n","import { mapBy } from \"../utils\";\r\n\r\nexport const MAX_DELIVS = 1200;\r\nexport const SCENARIO_KEY_STRING = \"scens\";\r\nexport const DELIV_KEY_STRING = \"delivs\";\r\n\r\nexport const objectivesData = await (async function () {\r\n  const objs = await (await fetch(\"./all_objectives.json\")).json();\r\n\r\n  for (const obj of objs) {\r\n    for (const scen of obj[SCENARIO_KEY_STRING]) {\r\n      scen[DELIV_KEY_STRING] = scen[DELIV_KEY_STRING].map((v) =>\r\n        Math.min(Math.max(0, v), MAX_DELIVS)\r\n      ).sort((a, b) => b - a);\r\n    }\r\n    // obj[SCENARIO_KEY_STRING] = obj[SCENARIO_KEY_STRING].slice(0, 100);\r\n    obj[SCENARIO_KEY_STRING] = mapBy(\r\n      obj[SCENARIO_KEY_STRING],\r\n      ({ name }) => name\r\n    );\r\n  }\r\n\r\n  console.log(\"DATA: loading objectives data\");\r\n\r\n  return mapBy(objs, ({ obj }) => obj);\r\n})();\r\n","import * as d3 from \"d3\";\r\nimport Matter from \"matter-js\";\r\n\r\n// when fn is `({ name }) => name`, turns\r\n//\r\n//  [\r\n//    { name: \"Zeta\", age: 30 },\r\n//    { name: \"Aloy\", age: 40 },\r\n//  ];\r\n//\r\n// to\r\n//\r\n//  {\r\n//    \"Zeta\": { name: \"Zeta\", age: 30 },\r\n//    \"Aloy\": { name: \"Aloy\", age: 40 },\r\n//  };\r\nexport function mapBy(objs, fn) {\r\n  const newObjs = Object.groupBy(objs, fn);\r\n\r\n  for (const key of Object.keys(newObjs)) {\r\n    newObjs[key] = newObjs[key][0];\r\n  }\r\n\r\n  return newObjs;\r\n}\r\n\r\nexport const WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.sqrt(2) / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\nexport function percentToRatioFilled(p) {\r\n  return (3.1304 * p ** 3 - 4.2384 * p ** 2 + 3.3471 * p + 0.0298) / 2.4;\r\n}\r\n\r\nexport function kernelDensityEstimator(kernel, X) {\r\n  return function (V) {\r\n    return X.map(function (x) {\r\n      return [\r\n        x,\r\n        d3.mean(V, function (v) {\r\n          return kernel(x - v);\r\n        }),\r\n      ];\r\n    });\r\n  };\r\n}\r\n\r\nexport function kernelEpanechnikov(k) {\r\n  return function (v) {\r\n    return Math.abs((v /= k)) <= 1 ? (0.75 * (1 - v * v)) / k : 0;\r\n  };\r\n}\r\n\r\nfunction generateWaterdrop(width) {\r\n  const rad = width / 2;\r\n  const partitions = 20;\r\n  const delta = (Math.PI * 3) / 2 / partitions;\r\n\r\n  const outer = [\r\n    {\r\n      x: Math.cos((Math.PI * 5) / 4) * rad,\r\n      y: Math.sin((Math.PI * 5) / 4) * rad,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: -Math.SQRT2 * rad,\r\n    },\r\n  ];\r\n\r\n  for (let i = 0; i <= partitions; i++) {\r\n    outer.push({\r\n      x: Math.cos(i * delta - Math.PI / 4) * rad,\r\n      y: Math.sin(i * delta - Math.PI / 4) * rad,\r\n    });\r\n  }\r\n\r\n  return outer;\r\n}\r\n\r\nexport function generateRandoPoints(shape, count) {\r\n  const bounds = Matter.Bounds.create(shape);\r\n\r\n  const minX = bounds.min.x,\r\n    maxX = bounds.max.x,\r\n    minY = bounds.min.y,\r\n    maxY = bounds.max.y;\r\n\r\n  const genX = d3.scaleLinear([minX, maxX]);\r\n  const genY = d3.scaleLinear([minY, maxY]);\r\n\r\n  const points = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    while (true) {\r\n      const x = genX(Math.random());\r\n      const y = genY(Math.random());\r\n\r\n      if (Matter.Vertices.contains(shape, { x, y })) {\r\n        points.push([x, y]);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\n// inner diameter of 1\r\nexport const WATERDROP_CAGE_COORDS = (function () {\r\n  const outer = generateWaterdrop(1.4);\r\n  const inner = generateWaterdrop(1);\r\n\r\n  const coords = [];\r\n\r\n  for (let i = 0; i < outer.length - 1; i++) {\r\n    coords.push([outer[i], outer[i + 1], inner[i + 1], inner[i]]);\r\n  }\r\n\r\n  return coords;\r\n})();\r\n\r\nlet RANDO_CACHE;\r\n\r\n// assuming nodes is already ordered and first nodes are going to be put on the bottom\r\nexport function placeDropsUsingPhysics(x, y, nodes) {\r\n  // first generate random points within water droplet. we can stop here, but points might not be the most uniformly distributed\r\n  RANDO_CACHE =\r\n    RANDO_CACHE || generateRandoPoints(generateWaterdrop(1), nodes.length);\r\n\r\n  const DELTA = d3.mean(nodes.map(({ r }) => r * 2));\r\n  const WIDTH_AREA = DELTA * Math.floor(Math.sqrt(nodes.length));\r\n\r\n  const randoPoints = RANDO_CACHE.map(([x, y]) => [\r\n    (x * WIDTH_AREA) / 2,\r\n    (y * WIDTH_AREA) / 2,\r\n  ]);\r\n\r\n  // thus, we use physics engine to take care of distributing the points evenly and based on radius\r\n  const Engine = Matter.Engine,\r\n    Bodies = Matter.Bodies,\r\n    Composite = Matter.Composite;\r\n\r\n  const engine = Engine.create();\r\n\r\n  const nodePos = randoPoints.sort((a, b) => b[1] - a[1]);\r\n\r\n  const node_bodies = nodes.map(({ r, id }, i) => {\r\n    const [nx, ny] = nodePos[i];\r\n    return Bodies.circle(nx + x, ny + y, r * 2, {\r\n      restitution: 0,\r\n      id: id,\r\n    });\r\n  });\r\n\r\n  const parts = WATERDROP_CAGE_COORDS.map((quad) =>\r\n    Matter.Body.create({\r\n      position: Matter.Vertices.centre(quad),\r\n      vertices: quad,\r\n      isStatic: true,\r\n    })\r\n  );\r\n\r\n  const cage = Matter.Body.create({\r\n    isStatic: true,\r\n  });\r\n\r\n  Matter.Body.setParts(cage, parts);\r\n  Matter.Body.scale(cage, WIDTH_AREA * 1.4, WIDTH_AREA * 1.4);\r\n  Matter.Body.translate(cage, { x, y: y + (WIDTH_AREA / 2) * 0.4 });\r\n\r\n  Composite.add(engine.world, [...node_bodies, cage]);\r\n\r\n  // run engine for 1 second at 60 fps\r\n  for (let i = 0, FPS = 60; i < FPS * 1; i++) Engine.update(engine, 1000 / FPS);\r\n\r\n  return node_bodies.map(({ position, id }) => ({\r\n    id,\r\n    x: position.x,\r\n    y: position.y,\r\n  }));\r\n}\r\n\r\n// https://gist.github.com/mbostock/5743979\r\nexport function bounce(h) {\r\n  if (!arguments.length) h = 0.25;\r\n  var b0 = 1 - h,\r\n    b1 = b0 * (1 - b0) + b0,\r\n    b2 = b0 * (1 - b1) + b1,\r\n    x0 = 2 * Math.sqrt(h),\r\n    x1 = x0 * Math.sqrt(h),\r\n    x2 = x1 * Math.sqrt(h),\r\n    t0 = 1 / (1 + x0 + x1 + x2),\r\n    t1 = t0 + t0 * x0,\r\n    t2 = t1 + t0 * x1,\r\n    m0 = t0 + (t0 * x0) / 2,\r\n    m1 = t1 + (t0 * x1) / 2,\r\n    m2 = t2 + (t0 * x2) / 2,\r\n    a = 1 / (t0 * t0);\r\n  return function (t) {\r\n    return t >= 1\r\n      ? 1\r\n      : t < t0\r\n      ? a * t * t\r\n      : t < t1\r\n      ? a * (t -= m0) * t + b0\r\n      : t < t2\r\n      ? a * (t -= m1) * t + b1\r\n      : a * (t -= m2) * t + b2;\r\n  };\r\n}\r\n"],"names":["LEVELS","LINE_WIDTH","DEFAULT_OBJECTIVE_IDX","BigBucketApp","_ref","width","height","current","objectiveIDs","useRef","Object","keys","objectivesData","curObjectiveIdx","setCurObjectiveIdx","useState","bucketSvgSelector","orderedScenIDs","useMemo","criteriaSort","curPercentileScens","Array","from","filter","_","i","ticksExact","map","d","Math","floor","length","includes","waterLevels","s","createInterps","innerWidth","innerHeight","x","d3","range","y","useEffect","svgContainer","attr","append","concat","bucketPath","split","select","selectAll","data","join","transition","duration","dd","ddd","push","ceil","y1","y0","_jsxs","className","children","_jsx","value","onChange","e","parseInt","target","objectiveID","name","ref","curScen","delivs","SCENARIO_KEY_STRING","DELIV_KEY_STRING","domain","v","min","clamp","criteria","objective","sort","a","b","start","stop","count","filled","arguments","undefined","taper","bottomRight","bottomLeft","lineFunc","quantileBins","numericBins","unitsPerQuantile","maxQuantiles","bin","round","sum","Infinity","usePrevious","isEqualFunc","prev","MAX_DELIVS","async","objs","fetch","json","obj","scen","max","mapBy","console","log","_ref2","fn","newObjs","groupBy","key","WATERDROP_ICON","draw","context","size","moveTo","lineTo","arc","sqrt","PI","closePath","percentToRatioFilled","p","kernelDensityEstimator","kernel","X","V","kernelEpanechnikov","k","abs","generateWaterdrop","rad","delta","outer","cos","sin","SQRT2","WATERDROP_CAGE_COORDS","inner","coords","RANDO_CACHE","placeDropsUsingPhysics","nodes","shape","bounds","Matter","create","minX","maxX","minY","maxY","genX","genY","points","random","contains","generateRandoPoints","WIDTH_AREA","r","randoPoints","Engine","Bodies","Composite","engine","nodePos","node_bodies","_ref3","id","nx","ny","circle","restitution","parts","quad","position","centre","vertices","isStatic","cage","setParts","scale","translate","add","world","FPS","update","_ref4"],"sourceRoot":""}