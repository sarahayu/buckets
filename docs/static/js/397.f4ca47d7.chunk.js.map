{"version":3,"file":"static/js/397.f4ca47d7.chunk.js","mappings":"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","sources":["ExplanationAnimApp.jsx","bucket-lib/BucketGlyph.jsx","bucket-lib/utils.js","data/objectivesData.jsx","utils.js"],"sourcesContent":["import React, { useEffect, useLayoutEffect, useRef, useState } from \"react\";\r\nimport * as d3 from \"d3\";\r\nimport {\r\n  DELIV_KEY_STRING,\r\n  DELIV_KEY_STRING_UNORD,\r\n  MAX_DELIVS,\r\n  SCENARIO_KEY_STRING,\r\n  objectiveIDs,\r\n  objectivesData,\r\n} from \"./data/objectivesData\";\r\nimport BucketGlyph from \"./bucket-lib/BucketGlyph\";\r\nimport { interpolateWatercolorBlue, ticksExact } from \"./bucket-lib/utils\";\r\n\r\nconst DEFAULT_SCENARIO_1 = \"expl0595\";\r\nconst DEFAULT_OBJECTIVE_IDX = objectiveIDs.indexOf(\"C_STANGDWN_MIF\");\r\n\r\nexport default function ExplanationAnimApp() {\r\n  const [curObjectiveIdx, setCurObjectiveIdx] = useState(DEFAULT_OBJECTIVE_IDX);\r\n  const [slide, setSlide] = useState(-1);\r\n  const lastSlide = useRef(0);\r\n  const slideFns = useRef([]);\r\n\r\n  const svgContainer = useRef();\r\n  const [bucketInterper, setBucketInterper] = useState(() => () => 0);\r\n\r\n  const width = 800,\r\n    height = 400;\r\n\r\n  useLayoutEffect(() => {\r\n    svgContainer.current.selectAll(\"*\").remove();\r\n\r\n    const handleClick = () => {\r\n      setSlide((p) => p + 1);\r\n    };\r\n\r\n    svgContainer.current.node().addEventListener(\"click\", handleClick);\r\n    document.querySelector(\".bucket-wrapper\").style.display = \"none\";\r\n\r\n    const margin = { top: 30, right: 30, bottom: 30, left: 60 };\r\n\r\n    const svgGroup = svgContainer.current\r\n      .attr(\"width\", width + margin.left + margin.right)\r\n      .attr(\"height\", height + margin.top + margin.bottom)\r\n      .style(\"background\", \"rgb(251, 251, 255)\")\r\n      .attr(\"opacity\", 1)\r\n      .append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},${margin.top})`);\r\n\r\n    const curObjective = objectiveIDs[curObjectiveIdx];\r\n\r\n    const vals = objectivesData[curObjective][SCENARIO_KEY_STRING][\r\n      DEFAULT_SCENARIO_1\r\n    ][DELIV_KEY_STRING_UNORD].map((val, realIdx) => ({\r\n      val,\r\n      realIdx,\r\n      year: realIdx + 1930,\r\n    })).sort((a, b) => b.val - a.val);\r\n\r\n    setBucketInterper(() =>\r\n      d3\r\n        .scaleLinear()\r\n        .domain(ticksExact(0, 1, vals.length))\r\n        .range(\r\n          objectivesData[curObjective][SCENARIO_KEY_STRING][DEFAULT_SCENARIO_1][\r\n            DELIV_KEY_STRING\r\n          ].map((v) => Math.min(1, v / MAX_DELIVS))\r\n        )\r\n        .clamp(true)\r\n    );\r\n\r\n    const xByYear = d3\r\n      .scaleBand()\r\n      .domain(vals.map(({ year }) => year).sort())\r\n      .range([0, width])\r\n      .padding(0.4);\r\n    const xaxis = d3\r\n      .axisBottom(xByYear)\r\n      .tickSize(0)\r\n      .tickValues(xByYear.domain().filter((_, i) => i % 10 === 0));\r\n    const svgAxis = svgGroup\r\n      .append(\"g\")\r\n      .attr(\"class\", \"anim-xaxis\")\r\n      .attr(\"opacity\", 1)\r\n      .attr(\"transform\", `translate(0, ${height})`)\r\n      .call(xaxis);\r\n    svgAxis\r\n      .selectAll(\"text\")\r\n      .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\r\n      .style(\"text-anchor\", \"end\");\r\n\r\n    const y = d3.scaleLinear().domain([0, MAX_DELIVS]).range([height, 0]);\r\n    svgGroup.append(\"g\").call(d3.axisLeft(y));\r\n\r\n    slideFns.current[0] = () => {\r\n      svgGroup\r\n        .selectAll(\".bars\")\r\n        .data(vals, (d) => d.realIdx)\r\n        .join(\"rect\")\r\n        .attr(\"class\", \"bars\")\r\n        .attr(\"x\", (d, i) => xByYear(d.year))\r\n        .attr(\"y\", height)\r\n        .attr(\"width\", xByYear.bandwidth())\r\n        .attr(\"height\", 0)\r\n        .attr(\"opacity\", 1)\r\n        .attr(\"fill\", \"steelblue\")\r\n        .transition()\r\n        .duration(500)\r\n        .delay((d) => d.realIdx * 10)\r\n        .attr(\"y\", (d) => y(d.val))\r\n        .attr(\"height\", (d) => height - y(d.val));\r\n    };\r\n\r\n    slideFns.current[1] = () => {\r\n      const biggerWidth = width / 8;\r\n      const finalWidth = width / 5;\r\n\r\n      xaxis.tickFormat(\"\");\r\n      svgAxis.call(xaxis);\r\n\r\n      const b = svgGroup.selectAll(\".bars\").data(vals, (d) => d.realIdx);\r\n\r\n      b.style(\"mix-blend-mode\", \"multiply\")\r\n        .transition()\r\n        .duration(500)\r\n        .attr(\"opacity\", 0.05)\r\n        .transition()\r\n        .delay((d) => 100 + (1 - (1 - d.realIdx / vals.length) ** 4) * 1000)\r\n        .duration(500)\r\n        .attr(\"width\", biggerWidth)\r\n        .attr(\"x\", (d) => width / 2 - biggerWidth / 2)\r\n        .transition()\r\n        .duration(500)\r\n        .delay(100 + vals.length * 100)\r\n        .attr(\"x\", width / 2 - finalWidth / 2)\r\n        .attr(\"width\", finalWidth);\r\n\r\n      svgGroup\r\n        .select(\".anim-xaxis\")\r\n        .transition()\r\n        .delay(2000)\r\n        .transition(500)\r\n        .attr(\"transform\", `translate(0, ${height + 50})`)\r\n        .attr(\"opacity\", 0);\r\n\r\n      b.transition()\r\n        .delay(2000 + 500)\r\n        .attr(\"x\", 0);\r\n\r\n      svgGroup\r\n        .transition()\r\n        .delay(2000 + 500)\r\n        .attr(\r\n          \"transform\",\r\n          `translate(${margin.left + width / 2 - finalWidth / 2},${margin.top})`\r\n        );\r\n    };\r\n\r\n    slideFns.current[2] = () => {\r\n      svgGroup\r\n        .selectAll(\".bars\")\r\n        .data(vals, (d) => d.realIdx)\r\n        .style(\"mix-blend-mode\", \"normal\")\r\n        .attr(\"fill\", (_, i) =>\r\n          interpolateWatercolorBlue(i / (vals.length - 1))\r\n        )\r\n        .transition()\r\n        .attr(\"opacity\", 1);\r\n    };\r\n\r\n    slideFns.current[3] = () => {\r\n      document.querySelector(\".bucket-wrapper\").style.display = \"initial\";\r\n      svgContainer.current.transition().duration(500).attr(\"opacity\", 0);\r\n    };\r\n\r\n    return () => {\r\n      lastSlide.current = -1;\r\n      setSlide(-1);\r\n      svgContainer.current.node().removeEventListener(\"click\", handleClick);\r\n    };\r\n  }, [curObjectiveIdx]);\r\n\r\n  useEffect(() => {\r\n    if (slide === -1) {\r\n      setSlide(0);\r\n    }\r\n    if (lastSlide.current < slide && slide < slideFns.current.length) {\r\n      slideFns.current[slide]();\r\n    }\r\n\r\n    lastSlide.current = slide;\r\n  }, [slide]);\r\n\r\n  return (\r\n    <div className=\"explanation-anim-wrapper\">\r\n      <select\r\n        style={{\r\n          position: \"absolute\",\r\n          top: 0,\r\n        }}\r\n        value={curObjectiveIdx}\r\n        onChange={(e) => setCurObjectiveIdx(parseInt(e.target.value))}\r\n      >\r\n        {objectiveIDs.map((objectiveID, i) => (\r\n          <option name={i} value={i} key={i}>\r\n            {objectiveID}\r\n          </option>\r\n        ))}\r\n      </select>\r\n      <svg\r\n        ref={(e) => {\r\n          !svgContainer.current && (svgContainer.current = d3.select(e));\r\n        }}\r\n      ></svg>\r\n      {bucketInterper && (\r\n        <BucketGlyph levelInterp={bucketInterper} width={300} height={height} />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useId, useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport {\r\n  bucketPath,\r\n  interpolateWatercolorBlue,\r\n  ticksExact,\r\n  usePrevious,\r\n} from \"./utils\";\r\n\r\nconst DEGREE_SWAY = 40;\r\nconst LEVELS = 10;\r\nconst LINE_WIDTH = 3;\r\n\r\nexport default function BucketGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const id = useId();\r\n  const svgSelector = useRef();\r\n\r\n  const liquidLevels = useMemo(\r\n    () =>\r\n      ticksExact(0, 1 - 1 / resolution, resolution).map((d) => levelInterp(d)),\r\n    [levelInterp, resolution]\r\n  );\r\n\r\n  const prevLiquidLevels = usePrevious(liquidLevels);\r\n\r\n  const innerWidth = width - LINE_WIDTH * 2;\r\n  const innerHeight = height - LINE_WIDTH;\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-container\")\r\n      .attr(\"transform\", `translate(${LINE_WIDTH}, ${LINE_WIDTH / 2})`);\r\n\r\n    svgContainer\r\n      .append(\"defs\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask-\" + id)\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-mask-path\");\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"clip-path\", `url(#bucket-mask-${id})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-outline\")\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n  }, [id]); // id shouldn't change, basically empty dependency array\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .select(\".svg-container\");\r\n\r\n    svgContainer\r\n      .select(\".bucket-mask-path\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight));\r\n\r\n    svgContainer\r\n      .select(\".bucket-outline\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight).split(\"z\")[0]);\r\n  }, [width, height, innerWidth, innerHeight]);\r\n\r\n  useLayoutEffect(() => {\r\n    const liquids = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".bucketBox\")\r\n      .data(liquidLevels)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bucketBox\")\r\n      .attr(\"width\", innerWidth * 2)\r\n      .attr(\"height\", innerHeight * 2)\r\n      .attr(\"x\", -innerWidth / 2)\r\n      .attr(\"fill\", (_, i) => colorInterp(i / (resolution - 1)));\r\n\r\n    liquids\r\n      .transition(\"liquidLevel\")\r\n      .ease(d3.easeElasticOut.period(0.6))\r\n      .delay((_, i) => i * (100 / resolution))\r\n      .duration(1000)\r\n      .attr(\"y\", (d) => innerHeight - d * innerHeight);\r\n\r\n    liquids\r\n      .transition(\"liquidSway\")\r\n      .duration(2000)\r\n      .delay((_, i) => i * 10)\r\n      .ease(d3.easeQuad)\r\n      .attrTween(\"transform\", function (d, i) {\r\n        const diff = prevLiquidLevels ? Math.abs(prevLiquidLevels[i] - d) : 0;\r\n        return (t) =>\r\n          `rotate(${\r\n            Math.sin(\r\n              Math.min((Math.PI * 4 * t) / (0.5 * diff + 0.5), Math.PI * 4)\r\n            ) *\r\n            diff *\r\n            DEGREE_SWAY *\r\n            (1 - t)\r\n          }, ${innerWidth / 2}, ${0})`;\r\n      });\r\n  }, [\r\n    liquidLevels,\r\n    prevLiquidLevels,\r\n    width,\r\n    height,\r\n    innerWidth,\r\n    innerHeight,\r\n    resolution,\r\n    colorInterp,\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"bucket-wrapper\">\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useRef } from \"react\";\r\n\r\n// inclusive\r\nexport function ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nexport function bucketPath(width, height, filled = 1.0, taper = 0.8) {\r\n  let bottomRight = width * taper + (width * (1 - taper)) / 2,\r\n    bottomLeft = (width * (1 - taper)) / 2;\r\n  let data = [\r\n    {\r\n      x: d3.interpolate(bottomRight, width)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n    { x: bottomRight, y: height },\r\n    { x: bottomLeft, y: height },\r\n    {\r\n      x: d3.interpolate(bottomLeft, 0)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n  ];\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d.x;\r\n    })\r\n    .y(function (d) {\r\n      return d.y;\r\n    });\r\n  return lineFunc(data) + \"z\";\r\n}\r\n\r\nexport function quantileBins(numericBins, unitsPerQuantile, maxQuantiles) {\r\n  let quantileBins = numericBins.map((bin) =>\r\n    Math.round(bin.length / unitsPerQuantile)\r\n  );\r\n  let sum = d3.sum(quantileBins);\r\n\r\n  while (sum > maxQuantiles) {\r\n    quantileBins[\r\n      d3.minIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : Infinity\r\n      )\r\n    ] -= 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  while (sum < maxQuantiles) {\r\n    quantileBins[\r\n      d3.maxIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : -Infinity\r\n      )\r\n    ] += 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  return quantileBins;\r\n}\r\n\r\n// https://www.developerway.com/posts/implementing-advanced-use-previous-hook\r\nexport function usePrevious(value, isEqualFunc) {\r\n  // initialise the ref with previous and current values\r\n  const ref = useRef({\r\n    value: value,\r\n    prev: null,\r\n  });\r\n\r\n  const current = ref.current.value;\r\n\r\n  // if the value passed into hook doesn't match what we store as \"current\"\r\n  // move the \"current\" to the \"previous\"\r\n  // and store the passed value as \"current\"\r\n  if (isEqualFunc ? !isEqualFunc(value, current) : value !== current) {\r\n    ref.current = {\r\n      value: value,\r\n      prev: current,\r\n    };\r\n  }\r\n\r\n  // return the previous value only\r\n  return ref.current.prev;\r\n}\r\n\r\nexport const interpolateWatercolorBlue = (i) =>\r\n  d3.interpolateBlues(d3.scaleLinear([0.2, 1.0])(i));\r\n","import { mapBy } from \"../utils\";\r\n\r\nexport const MAX_DELIVS = 1200;\r\nexport const SCENARIO_KEY_STRING = \"scens\";\r\nexport const DELIV_KEY_STRING = \"delivs\";\r\nexport const DELIV_KEY_STRING_UNORD = \"delivs_unord\";\r\n\r\nexport const objectivesData = await (async function () {\r\n  const objs = await (await fetch(\"./all_objectives.json\")).json();\r\n\r\n  for (const obj of objs) {\r\n    obj[SCENARIO_KEY_STRING] = obj[SCENARIO_KEY_STRING];\r\n    for (const scen of obj[SCENARIO_KEY_STRING]) {\r\n      scen[DELIV_KEY_STRING_UNORD] = scen[DELIV_KEY_STRING];\r\n\r\n      scen[DELIV_KEY_STRING] = scen[DELIV_KEY_STRING_UNORD].map((v) =>\r\n        Math.min(Math.max(0, v), MAX_DELIVS)\r\n      ).sort((a, b) => b - a);\r\n    }\r\n    obj[SCENARIO_KEY_STRING] = mapBy(\r\n      obj[SCENARIO_KEY_STRING],\r\n      ({ name }) => name\r\n    );\r\n  }\r\n\r\n  console.log(\"DATA: loading objectives data\");\r\n\r\n  return mapBy(objs, ({ obj }) => obj);\r\n})();\r\n\r\nexport const objectiveIDs = Object.keys(objectivesData);\r\nexport const scenarioIDs = Object.keys(\r\n  Object.values(objectivesData)[0][SCENARIO_KEY_STRING]\r\n);\r\n","import * as THREE from \"three\";\r\nimport * as d3 from \"d3\";\r\nimport Matter from \"matter-js\";\r\nimport {\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useReducer,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { DELIV_KEY_STRING, SCENARIO_KEY_STRING } from \"./data/objectivesData\";\r\nimport { ticksExact } from \"./bucket-lib/utils\";\r\n\r\nexport function clamp(x, a, b) {\r\n  return Math.max(a, Math.min(b, x));\r\n}\r\n\r\n// when fn is `({ name }) => name`, turns\r\n//\r\n//  [\r\n//    { name: \"Zeta\", age: 30 },\r\n//    { name: \"Aloy\", age: 40 },\r\n//  ];\r\n//\r\n// to\r\n//\r\n//  {\r\n//    \"Zeta\": { name: \"Zeta\", age: 30 },\r\n//    \"Aloy\": { name: \"Aloy\", age: 40 },\r\n//  };\r\nexport function mapBy(objs, fn) {\r\n  const newObjs = Object.groupBy(objs, fn);\r\n\r\n  for (const key of Object.keys(newObjs)) {\r\n    newObjs[key] = newObjs[key][0];\r\n  }\r\n\r\n  return newObjs;\r\n}\r\n\r\n// size is height of waterdrop plus a bit more (1/2 of size is distance from top of drop to center of circle part)\r\nexport const WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.SQRT2 / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\n// path generated when WATERDROP_ICON size = 2\r\nexport const DROPLET_SHAPE = \"M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z\";\r\n\r\nexport function percentToRatioFilled(p) {\r\n  p -= 0.0088;\r\n  return Math.min(\r\n    1,\r\n    Math.max(\r\n      0,\r\n      (3.1304 * p ** 3 - 4.2384 * p ** 2 + 3.3471 * p + 0.0298) / 2.2326\r\n    )\r\n  );\r\n}\r\n\r\nconst CIRC_RAD = Math.SQRT1_2;\r\nconst DROP_RAD = 1;\r\nconst CIRC_HEIGHT = CIRC_RAD + CIRC_RAD;\r\nconst DROP_HEIGHT = DROP_RAD + CIRC_RAD;\r\nconst HAT_START = 0.75;\r\n\r\n// half width at widest is 1\r\nfunction yToHalfWidth(y) {\r\n  if (y >= HAT_START) {\r\n    const hatHalfWidth = Math.SQRT1_2;\r\n\r\n    return (hatHalfWidth * (1 - y)) / (1 - HAT_START);\r\n  }\r\n\r\n  const circFrac = fracDropToCirc(y);\r\n  const trigX = (1 - circFrac) * 2 - 1;\r\n\r\n  const angle = Math.acos(trigX);\r\n  const trigY = Math.sin(angle);\r\n\r\n  return trigY;\r\n}\r\n\r\n// fml, here sprite width is 2 (i.e. circ rad is 1) thus drop real height is 1 + sqrt2\r\nfunction yToSpriteY(y) {\r\n  return (y - CIRC_RAD / DROP_HEIGHT) * (1 + Math.SQRT2);\r\n}\r\n\r\nfunction spriteYToY(sy) {\r\n  return sy / (1 + Math.SQRT2) + CIRC_RAD / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracCircToDrop(v) {\r\n  return v / CIRC_HEIGHT / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracDropToCirc(v) {\r\n  return v / (CIRC_HEIGHT / DROP_HEIGHT);\r\n}\r\n\r\nexport function waterdropDeltaOutline(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const rightCoords = [];\r\n  const leftCoords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    rightCoords.push(v2, v3);\r\n    leftCoords.push(v1, v4);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  rightCoords.push(v2, v3);\r\n  leftCoords.push(v1, v4);\r\n\r\n  rightCoords.push(...leftCoords.reverse());\r\n\r\n  return rightCoords;\r\n}\r\n\r\nexport function waterdropDelta(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const coords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    coords.push([v1, v2, v3]);\r\n    coords.push([v1, v3, v4]);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  coords.push([v1, v2, v3]);\r\n  coords.push([v1, v3, v4]);\r\n\r\n  return coords;\r\n}\r\n\r\nexport function waterdrop(yFill, size = 2) {\r\n  if (yFill === 0) return [];\r\n\r\n  return waterdropDelta(0, yFill, size);\r\n}\r\n\r\nexport function kernelDensityEstimator(kernel, X) {\r\n  return function (V) {\r\n    return X.map(function (x) {\r\n      return [\r\n        x,\r\n        d3.mean(V, function (v) {\r\n          return kernel(x - v);\r\n        }),\r\n      ];\r\n    });\r\n  };\r\n}\r\n\r\nexport function kernelEpanechnikov(k) {\r\n  return function (v) {\r\n    return Math.abs((v /= k)) <= 1 ? (0.75 * (1 - v * v)) / k : 0;\r\n  };\r\n}\r\n\r\nfunction generateWaterdrop(width) {\r\n  const rad = width / 2;\r\n  const partitions = 16;\r\n  const delta = (Math.PI * 3) / 2 / partitions;\r\n\r\n  const outer = [\r\n    {\r\n      x: Math.cos((Math.PI * 5) / 4) * rad,\r\n      y: Math.sin((Math.PI * 5) / 4) * rad,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: -Math.SQRT2 * rad,\r\n    },\r\n  ];\r\n\r\n  for (let i = 0; i <= partitions; i++) {\r\n    outer.push({\r\n      x: Math.cos(i * delta - Math.PI / 4) * rad,\r\n      y: Math.sin(i * delta - Math.PI / 4) * rad,\r\n    });\r\n  }\r\n\r\n  return outer;\r\n}\r\n\r\nexport function generateRandoPoints(shape, count) {\r\n  const bounds = Matter.Bounds.create(shape);\r\n\r\n  const minX = bounds.min.x,\r\n    maxX = bounds.max.x,\r\n    minY = bounds.min.y,\r\n    maxY = bounds.max.y;\r\n\r\n  const genX = d3.scaleLinear([minX, maxX]);\r\n  const genY = d3.scaleLinear([minY, maxY]);\r\n\r\n  const points = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    while (true) {\r\n      const x = genX(Math.random());\r\n      const y = genY(Math.random());\r\n\r\n      if (Matter.Vertices.contains(shape, { x, y })) {\r\n        points.push([x, y]);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\n// inner diameter of 1\r\nexport const WATERDROP_CAGE_COORDS = (function () {\r\n  const outer = generateWaterdrop(3);\r\n  const inner = generateWaterdrop(1);\r\n\r\n  const coords = [];\r\n\r\n  for (let i = 0; i < outer.length - 2; i++) {\r\n    coords.push([\r\n      outer[i],\r\n      outer[i + (i < 2 ? 1 : 2)],\r\n      inner[i + (i < 2 ? 1 : 2)],\r\n      inner[i],\r\n    ]);\r\n  }\r\n\r\n  return coords;\r\n})();\r\n\r\nlet RANDO_CACHE;\r\nlet lastNodesLen;\r\n\r\nlet DET_CACHE;\r\nlet lastDetNodesLen;\r\n\r\nexport function radsToDropWidth(nodes) {\r\n  const AREA = d3.sum(nodes.map((r) => r ** 2 * 3.14));\r\n  return Math.floor((Math.sqrt(AREA / 3.14) * 2) / 2);\r\n}\r\n\r\n// assuming nodes is already ordered and first nodes are going to be put on the bottom\r\nexport function placeDropsUsingPhysics(x, y, nodes, reuse = false) {\r\n  if (reuse && DET_CACHE && nodes.length === lastDetNodesLen) return DET_CACHE;\r\n\r\n  // first generate random points within water droplet. we can stop here, but points might not be the most uniformly distributed\r\n\r\n  if (!RANDO_CACHE || nodes.length !== lastNodesLen)\r\n    RANDO_CACHE = d3\r\n      .range(4)\r\n      .map(() =>\r\n        generateRandoPoints(generateWaterdrop(1), (lastNodesLen = nodes.length))\r\n      );\r\n\r\n  const WIDTH_AREA = radsToDropWidth(nodes.map(({ r }) => r));\r\n\r\n  const randoPoints = RANDO_CACHE[\r\n    Math.floor(Math.random() * RANDO_CACHE.length)\r\n  ].map(([x, y]) => [x * WIDTH_AREA, y * WIDTH_AREA]);\r\n\r\n  // thus, we use physics engine to take care of distributing the points evenly and based on radius\r\n  const Engine = Matter.Engine,\r\n    Bodies = Matter.Bodies,\r\n    Composite = Matter.Composite;\r\n\r\n  const engine = Engine.create();\r\n\r\n  const nodePos = randoPoints.sort((a, b) => b[1] - a[1]);\r\n\r\n  const node_bodies = nodes.map(({ r, id }, i) => {\r\n    const [nx, ny] = nodePos[i];\r\n    return Bodies.circle(nx, ny, r, {\r\n      restitution: 0,\r\n      id: id,\r\n    });\r\n  });\r\n\r\n  const parts = WATERDROP_CAGE_COORDS.map((quad) =>\r\n    Matter.Body.create({\r\n      position: Matter.Vertices.centre(quad),\r\n      vertices: quad,\r\n      isStatic: true,\r\n    })\r\n  );\r\n\r\n  const cage = Matter.Body.create({\r\n    isStatic: true,\r\n  });\r\n\r\n  Matter.Body.setParts(cage, parts);\r\n\r\n  Matter.Body.setCentre(cage, { x: 0, y: 0 });\r\n  Matter.Body.scale(cage, WIDTH_AREA, WIDTH_AREA);\r\n\r\n  Composite.add(engine.world, [...node_bodies, cage]);\r\n\r\n  // run engine for SECS second at FPS fps\r\n  for (let i = 0, FPS = 60, SECS = 0.1; i < FPS * SECS; i++)\r\n    Engine.update(engine, 1000 / FPS);\r\n\r\n  const retVal = node_bodies.map(({ position, id }) => ({\r\n    id,\r\n    x: position.x + x,\r\n    y: position.y + y,\r\n  }));\r\n\r\n  retVal.height = (WIDTH_AREA / 2 / CIRC_RAD) * DROP_HEIGHT;\r\n\r\n  if (reuse && (!DET_CACHE || retVal.length !== lastDetNodesLen)) {\r\n    DET_CACHE = retVal;\r\n    lastDetNodesLen = retVal.length;\r\n  }\r\n\r\n  return retVal;\r\n}\r\n\r\n// https://gist.github.com/mbostock/5743979\r\nexport function bounce(h) {\r\n  if (!arguments.length) h = 0.25;\r\n  var b0 = 1 - h,\r\n    b1 = b0 * (1 - b0) + b0,\r\n    b2 = b0 * (1 - b1) + b1,\r\n    x0 = 2 * Math.sqrt(h),\r\n    x1 = x0 * Math.sqrt(h),\r\n    x2 = x1 * Math.sqrt(h),\r\n    t0 = 1 / (1 + x0 + x1 + x2),\r\n    t1 = t0 + t0 * x0,\r\n    t2 = t1 + t0 * x1,\r\n    m0 = t0 + (t0 * x0) / 2,\r\n    m1 = t1 + (t0 * x1) / 2,\r\n    m2 = t2 + (t0 * x2) / 2,\r\n    a = 1 / (t0 * t0);\r\n  return function (t) {\r\n    return t >= 1\r\n      ? 1\r\n      : t < t0\r\n      ? a * t * t\r\n      : t < t1\r\n      ? a * (t -= m0) * t + b0\r\n      : t < t2\r\n      ? a * (t -= m1) * t + b1\r\n      : a * (t -= m2) * t + b2;\r\n  };\r\n}\r\n\r\nexport function rangeInclusive(a, b) {\r\n  return d3.range(a, b + 1);\r\n}\r\n\r\nexport function useStickyScale(defaultVal, scale) {\r\n  const [val, setVal] = useState(defaultVal);\r\n\r\n  const valActual = useMemo(() => scale(val), [val]);\r\n  const setValActual = useCallback((v) => void setVal(scale(v)), []);\r\n\r\n  return [valActual, setValActual];\r\n}\r\n\r\nexport function createInterps(obj_name, scen_name, data, maxDelivs) {\r\n  const delivs =\r\n    data[obj_name][SCENARIO_KEY_STRING][scen_name][DELIV_KEY_STRING];\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\nexport function criteriaSort(criteria, data, objective) {\r\n  if (criteria === \"median\") {\r\n    return Object.keys(data[objective][SCENARIO_KEY_STRING]).sort(\r\n      (a, b) =>\r\n        d3.mean(data[objective][SCENARIO_KEY_STRING][a][DELIV_KEY_STRING]) -\r\n        d3.mean(data[objective][SCENARIO_KEY_STRING][b][DELIV_KEY_STRING])\r\n    );\r\n  }\r\n  if (criteria === \"deliveries\") {\r\n    return Object.keys(data[objective][SCENARIO_KEY_STRING]).sort(\r\n      (a, b) =>\r\n        d3.max(data[objective][SCENARIO_KEY_STRING][a][DELIV_KEY_STRING]) -\r\n        d3.max(data[objective][SCENARIO_KEY_STRING][b][DELIV_KEY_STRING])\r\n    );\r\n  }\r\n  if (criteria === \"alphabetical\") {\r\n    return Object.keys(data[objective][SCENARIO_KEY_STRING]).sort();\r\n  }\r\n}\r\n\r\nfunction get(object, path, defaultValue) {\r\n  const parts = path.split(\".\");\r\n  for (let part of parts) {\r\n    if (!object) return defaultValue;\r\n    object = object[part];\r\n  }\r\n  return object ?? defaultValue;\r\n}\r\n\r\nfunction pick(fn) {\r\n  return typeof fn === \"string\" ? (v) => get(v, fn) : fn;\r\n}\r\n\r\nexport function sortBy(array, fn) {\r\n  fn = pick(fn);\r\n  return array.sort((a, b) => {\r\n    const va = fn(a);\r\n    const vb = fn(b);\r\n    if (va < vb) return -1;\r\n    if (va > vb) return 1;\r\n    return 0;\r\n  });\r\n}\r\n\r\nexport function toRadians(a) {\r\n  return (a * Math.PI) / 180;\r\n}\r\n\r\nexport class Camera {\r\n  fov;\r\n  near;\r\n  far;\r\n  width;\r\n  height;\r\n  camera;\r\n  zoom;\r\n  view;\r\n  curTransform;\r\n\r\n  constructor({ fov, near, far, width, height, domElement, zoomFn }) {\r\n    this.fov = fov;\r\n    this.near = near;\r\n    this.far = far;\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      fov,\r\n      width / height,\r\n      near,\r\n      far + 1\r\n    );\r\n\r\n    this.camera.position.set(0, 0, this.far);\r\n\r\n    this.zoom = d3\r\n      .zoom()\r\n      .scaleExtent([\r\n        this.getScaleFromZ(this.far),\r\n        this.getScaleFromZ(this.near),\r\n      ])\r\n      .on(\"zoom\", (e) => {\r\n        this.d3ZoomHandler(e);\r\n        this.curTransform = e.transform;\r\n\r\n        zoomFn && zoomFn(e);\r\n      });\r\n\r\n    this.view = d3.select(domElement);\r\n    this.view.call(this.zoom);\r\n    this.zoom.transform(\r\n      this.view,\r\n      d3.zoomIdentity\r\n        .translate(this.width / 2, this.height / 2)\r\n        .scale(this.getScaleFromZ(this.far))\r\n    );\r\n  }\r\n\r\n  d3ZoomHandler(e) {\r\n    const scale = e.transform.k;\r\n    const x = -(e.transform.x - this.width / 2) / scale;\r\n    const y = (e.transform.y - this.height / 2) / scale;\r\n    const z = this.getZFromScale(scale);\r\n    this.camera.position.set(x, y, z);\r\n  }\r\n\r\n  getScaleFromZ(camera_z_position) {\r\n    const half_fov = this.fov / 2;\r\n    const half_fov_radians = toRadians(half_fov);\r\n    const half_fov_height = Math.tan(half_fov_radians) * camera_z_position;\r\n    const fov_height = half_fov_height * 2;\r\n    const scale = this.height / fov_height;\r\n    return scale;\r\n  }\r\n\r\n  getZFromScale(scale) {\r\n    const half_fov = this.fov / 2;\r\n    const half_fov_radians = toRadians(half_fov);\r\n    const scale_height = this.height / scale;\r\n    const camera_z_position = scale_height / (2 * Math.tan(half_fov_radians));\r\n    return camera_z_position;\r\n  }\r\n}\r\n\r\nexport class MeshGeometry {\r\n  threeGeom = new THREE.Geometry();\r\n  idx = 0;\r\n\r\n  addMeshCoords(meshCoords, transform, color, z = 0) {\r\n    const indices = [];\r\n\r\n    for (let j = 0; j < meshCoords.length; j++) {\r\n      const [v1, v2, v3] = meshCoords[j];\r\n\r\n      const a = new THREE.Vector3(transform.x + v1[0], transform.y - v1[1], z);\r\n      const b = new THREE.Vector3(transform.x + v2[0], transform.y - v2[1], z);\r\n      const c = new THREE.Vector3(transform.x + v3[0], transform.y - v3[1], z);\r\n      this.threeGeom.vertices.push(a, b, c);\r\n\r\n      const face = new THREE.Face3(\r\n        this.idx * 3 + 0,\r\n        this.idx * 3 + 1,\r\n        this.idx * 3 + 2\r\n      );\r\n\r\n      if (color) {\r\n        face.vertexColors.push(color);\r\n        face.vertexColors.push(color);\r\n        face.vertexColors.push(color);\r\n      }\r\n\r\n      this.threeGeom.faces.push(face);\r\n\r\n      indices.push(this.idx++);\r\n    }\r\n\r\n    return indices;\r\n  }\r\n}\r\n\r\nexport function mouseToThree(mouseX, mouseY, width, height) {\r\n  return new THREE.Vector3(\r\n    (mouseX / width) * 2 - 1,\r\n    -(mouseY / height) * 2 + 1,\r\n    1\r\n  );\r\n}\r\n\r\nexport function useStateRef(val) {\r\n  const [state, _setState] = useState(val);\r\n  const stateRef = useRef(val);\r\n\r\n  useEffect(() => void (stateRef.current = state), [state]);\r\n\r\n  const setState = useCallback((v) => {\r\n    _setState((stateRef.current = v));\r\n  }, []);\r\n\r\n  return [state, setState, stateRef];\r\n}\r\n"],"names":["DEFAULT_SCENARIO_1","DEFAULT_OBJECTIVE_IDX","objectiveIDs","indexOf","ExplanationAnimApp","curObjectiveIdx","setCurObjectiveIdx","useState","slide","setSlide","lastSlide","useRef","slideFns","svgContainer","bucketInterper","setBucketInterper","width","height","useLayoutEffect","current","selectAll","remove","handleClick","p","node","addEventListener","document","querySelector","style","display","margin","svgGroup","attr","append","concat","curObjective","vals","objectivesData","SCENARIO_KEY_STRING","DELIV_KEY_STRING_UNORD","map","val","realIdx","year","sort","a","b","d3","domain","ticksExact","length","range","DELIV_KEY_STRING","v","Math","min","MAX_DELIVS","clamp","xByYear","_ref","padding","xaxis","tickSize","tickValues","filter","_","i","svgAxis","call","y","data","d","join","bandwidth","transition","duration","delay","tickFormat","select","finalWidth","interpolateWatercolorBlue","removeEventListener","useEffect","_jsxs","className","children","_jsx","position","top","value","onChange","e","parseInt","target","objectiveID","name","ref","BucketGlyph","levelInterp","DEGREE_SWAY","LEVELS","LINE_WIDTH","colorInterp","resolution","id","useId","svgSelector","liquidLevels","useMemo","prevLiquidLevels","usePrevious","innerWidth","innerHeight","bucketPath","split","liquids","ease","period","attrTween","diff","abs","t","sin","PI","start","stop","count","filled","arguments","undefined","taper","bottomRight","bottomLeft","x","lineFunc","quantileBins","numericBins","unitsPerQuantile","maxQuantiles","bin","round","sum","Infinity","isEqualFunc","prev","async","objs","fetch","json","obj","scen","max","mapBy","console","log","_ref2","Object","keys","scenarioIDs","values","fn","newObjs","groupBy","key","WATERDROP_ICON","draw","context","size","moveTo","lineTo","arc","SQRT2","closePath","DROPLET_SHAPE","CIRC_RAD","SQRT1_2","DROP_RAD","CIRC_HEIGHT","DROP_HEIGHT","HAT_START","yToHalfWidth","trigX","angle","acos","yToSpriteY","spriteYToY","sy","waterdropDeltaOutline","yStart","yEnd","rad","Y_DELTA","rightCoords","leftCoords","dx1","dy1","dx2","dy2","ceil","v1","v2","v3","v4","push","reverse","waterdropDelta","coords","kernelDensityEstimator","kernel","X","V","kernelEpanechnikov","k","generateWaterdrop","delta","outer","cos","generateRandoPoints","shape","bounds","Matter","create","minX","maxX","minY","maxY","genX","genY","points","random","contains","WATERDROP_CAGE_COORDS","inner","RANDO_CACHE","lastNodesLen","DET_CACHE","lastDetNodesLen","radsToDropWidth","nodes","AREA","r","floor","sqrt","placeDropsUsingPhysics","reuse","WIDTH_AREA","randoPoints","Engine","Bodies","Composite","engine","nodePos","node_bodies","_ref3","nx","ny","circle","restitution","parts","quad","centre","vertices","isStatic","cage","setParts","setCentre","scale","add","world","FPS","SECS","update","retVal","_ref4","useStickyScale","defaultVal","setVal","useCallback","createInterps","obj_name","scen_name","maxDelivs","delivs","criteriaSort","criteria","objective","toRadians","Camera","constructor","_ref5","fov","near","far","domElement","zoomFn","this","camera","THREE","set","zoom","scaleExtent","getScaleFromZ","on","d3ZoomHandler","curTransform","transform","view","translate","z","getZFromScale","camera_z_position","half_fov_radians","fov_height","tan","MeshGeometry","threeGeom","idx","addMeshCoords","meshCoords","color","indices","j","c","face","vertexColors","faces","useStateRef","state","_setState","stateRef","setState"],"sourceRoot":""}