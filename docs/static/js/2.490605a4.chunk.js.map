{"version":3,"file":"static/js/2.490605a4.chunk.js","mappings":"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","sources":["RecursiveDropletsBasicApp.jsx","RecursiveDropletsWatercolorApp.jsx","bucket-lib/utils.js","data/objectivesData.jsx","utils.js"],"sourcesContent":["import * as d3 from \"d3\";\r\nimport React, { useLayoutEffect, useMemo, useRef, useState } from \"react\";\r\nimport { ticksExact } from \"./bucket-lib/utils\";\r\nimport {\r\n  DELIV_KEY_STRING,\r\n  SCENARIO_KEY_STRING,\r\n  objectivesData,\r\n} from \"./data/objectivesData\";\r\nimport { percentToRatioFilled, placeDropsUsingPhysics } from \"./utils\";\r\n\r\nconst LEVELS = 10;\r\nconst DEFAULT_OBJECTIVE_IDX = 0;\r\nconst RAD_PX = 15;\r\nconst DROPLET_SHAPE = \"M0,-10L5,-5A7.071,7.071,0,1,1,-5,-5L0,-10Z\";\r\nconst SVG_DROPLET_WIDTH_DONT_CHANGE = 4;\r\n\r\nexport default function RecursiveDropletsBasicApp({ watercolor = false }) {\r\n  const { current: objectiveIDs } = useRef(Object.keys(objectivesData));\r\n  const winDim = useRef();\r\n  const [curObjectiveIdx, setCurObjectiveIdx] = useState(DEFAULT_OBJECTIVE_IDX);\r\n  const [normalize, setNormalize] = useState(false);\r\n\r\n  const bucketSvgSelector = useRef();\r\n\r\n  const orderedScenIDs = useMemo(\r\n    () => criteriaSort(\"median\", objectivesData, objectiveIDs[curObjectiveIdx]),\r\n    [curObjectiveIdx]\r\n  );\r\n\r\n  const waterLevels = useMemo(\r\n    () =>\r\n      orderedScenIDs\r\n        .map((s) => {\r\n          const i = createInterps(objectiveIDs[curObjectiveIdx], s);\r\n          return ticksExact(0, 1, LEVELS + 1).map((d) => i(d));\r\n        })\r\n        .reverse(),\r\n    [curObjectiveIdx]\r\n  );\r\n\r\n  useLayoutEffect(() => {\r\n    winDim.current = {\r\n      width: window.innerWidth,\r\n      height: window.innerHeight,\r\n    };\r\n\r\n    bucketSvgSelector.current\r\n      .attr(\"width\", window.innerWidth)\r\n      .attr(\"height\", window.innerHeight);\r\n  }, []);\r\n\r\n  useLayoutEffect(() => {\r\n    const width = winDim.current.width,\r\n      height = winDim.current.height;\r\n\r\n    const scale = 1 / (normalize ? d3.max(waterLevels.map((l) => l[0])) : 1);\r\n\r\n    const nodes_pos = placeDropsUsingPhysics(\r\n      width / 2,\r\n      height / 2,\r\n      waterLevels.map((levs, idx) => ({\r\n        r: levs[0] * scale * RAD_PX,\r\n        id: idx,\r\n      }))\r\n    );\r\n\r\n    const nodes = nodes_pos.map(({ id: idx, x, y }) => ({\r\n      levs: waterLevels[idx].map((w) => w * scale),\r\n      maxLev: waterLevels[idx][0] * scale,\r\n      tilt: Math.random() * 50 - 25,\r\n      dur: Math.random() * 500 + 1000,\r\n      startX: x,\r\n      startY: d3.scaleLinear([-RAD_PX * 2 - RAD_PX, -RAD_PX * 2])(\r\n        Math.random()\r\n      ),\r\n      endX: x,\r\n      endY: y,\r\n    }));\r\n\r\n    bucketSvgSelector.current\r\n      .selectAll(\".dropTranslateY\")\r\n      .data(nodes, (_, i) => i)\r\n      .join((enter) => {\r\n        return enter\r\n          .append(\"g\")\r\n          .attr(\"class\", \"dropTranslateY\")\r\n          .call((s) => {\r\n            s.append(\"g\")\r\n              .attr(\"class\", \"dropTranslateX\")\r\n              .each(function ({ levs, maxLev }, i) {\r\n                d3.select(this)\r\n                  .append(\"defs\")\r\n                  .append(\"clipPath\")\r\n                  .attr(\"id\", \"drop-mask-\" + i)\r\n                  .append(\"path\")\r\n                  .attr(\r\n                    \"transform\",\r\n                    `scale(${\r\n                      (maxLev * RAD_PX) / 2 / SVG_DROPLET_WIDTH_DONT_CHANGE\r\n                    })`\r\n                  )\r\n                  .attr(\"d\", DROPLET_SHAPE);\r\n                d3.select(this)\r\n                  .append(\"g\")\r\n                  .attr(\"clip-path\", `url(#drop-mask-${i})`)\r\n                  .selectAll(\"rect\")\r\n                  .data(levs, (_, i) => i)\r\n                  .join(\"rect\")\r\n                  .attr(\"width\", maxLev * RAD_PX * 2)\r\n                  .attr(\"height\", maxLev * RAD_PX * 2)\r\n                  .attr(\"x\", (-maxLev * RAD_PX * 2) / 2)\r\n                  .attr(\"y\", (-maxLev * RAD_PX * 2) / 2)\r\n                  .attr(\"fill\", (_, i) =>\r\n                    d3.interpolateBlues(d3.scaleLinear([0.2, 1.0])(i / LEVELS))\r\n                  );\r\n              });\r\n          });\r\n      })\r\n      .attr(\"transform\", ({ startY }) => `translate(0, ${startY})`)\r\n      .each(function ({ startX, tilt, levs, maxLev }) {\r\n        d3.select(this)\r\n          .select(\".dropTranslateX\")\r\n          .attr(\"transform\", `translate(${startX}, 0) rotate(${tilt})`)\r\n          .style(\"opacity\", 0.2);\r\n        d3.select(this)\r\n          .select(\".dropTranslateX\")\r\n          .selectAll(\"rect\")\r\n          .data(levs, (_, i) => i)\r\n          .attr(\"width\", maxLev * RAD_PX * 2)\r\n          .attr(\"height\", maxLev * RAD_PX * 2)\r\n          .attr(\"x\", (-maxLev * RAD_PX * 2) / 2)\r\n          .attr(\r\n            \"y\",\r\n            (l) =>\r\n              (maxLev * RAD_PX * 2) / 2 -\r\n              percentToRatioFilled(l / maxLev) * (maxLev * RAD_PX * 2)\r\n          );\r\n        d3.select(this)\r\n          .select(\".dropTranslateX\")\r\n          .select(\"path\")\r\n          .attr(\r\n            \"transform\",\r\n            `scale(${\r\n              (maxLev * RAD_PX) / 2 / Math.SQRT2 / SVG_DROPLET_WIDTH_DONT_CHANGE\r\n            })`\r\n          );\r\n      })\r\n      .call((s) => {\r\n        s.transition(\"y\")\r\n          .duration(({ dur }) => dur)\r\n          .delay((_, i) => Math.floor(i / 1) * 5)\r\n          .ease(d3.easeExpOut)\r\n          .attr(\"transform\", ({ endY }) => `translate(0, ${endY})`);\r\n      })\r\n      .call((s) => {\r\n        s.transition(\"trans\")\r\n          .duration(({ dur }) => dur * 0.5)\r\n          .delay((_, i) => Math.floor(i / 1) * 5)\r\n          .ease(d3.easeLinear)\r\n          .select(\".dropTranslateX\")\r\n          .attr(\r\n            \"transform\",\r\n            ({ endX, tilt }) => `translate(${endX}, 0) rotate(${tilt})`\r\n          )\r\n          .style(\"opacity\", 1);\r\n      });\r\n  }, [waterLevels, normalize]);\r\n\r\n  return (\r\n    <div className=\"bubbles-wrapper\">\r\n      <select\r\n        value={curObjectiveIdx}\r\n        onChange={(e) => setCurObjectiveIdx(parseInt(e.target.value))}\r\n      >\r\n        {objectiveIDs.map((objectiveID, i) => (\r\n          <option name={i} value={i} key={i}>\r\n            {objectiveID}\r\n          </option>\r\n        ))}\r\n      </select>\r\n      <input\r\n        type=\"checkbox\"\r\n        id=\"html\"\r\n        name=\"fav_language\"\r\n        value=\"HTML\"\r\n        checked={normalize}\r\n        onChange={() => void setNormalize((e) => !e)}\r\n      />\r\n      <label htmlFor=\"html\">normalize</label>\r\n      <div className={\"bubbles-svg-wrapper\" + (watercolor ? \"-painter\" : \"\")}>\r\n        <svg\r\n          className={\"bubbles-svg\" + (watercolor ? \"-painter\" : \"\")}\r\n          ref={(e) => void (bucketSvgSelector.current = d3.select(e))}\r\n        ></svg>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction createInterps(name, curScen) {\r\n  const delivs =\r\n    objectivesData[name][SCENARIO_KEY_STRING][curScen][DELIV_KEY_STRING];\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / 1200) || 0))\r\n    .clamp(true);\r\n}\r\n\r\nfunction criteriaSort(criteria, data, objective) {\r\n  if (criteria === \"median\") {\r\n    return Object.keys(data[objective][SCENARIO_KEY_STRING]).sort(\r\n      (a, b) =>\r\n        d3.mean(data[objective][SCENARIO_KEY_STRING][a][DELIV_KEY_STRING]) -\r\n        d3.mean(data[objective][SCENARIO_KEY_STRING][b][DELIV_KEY_STRING])\r\n    );\r\n  }\r\n  if (criteria === \"deliveries\") {\r\n    return Object.keys(data[objective][SCENARIO_KEY_STRING]).sort(\r\n      (a, b) =>\r\n        d3.max(data[objective][SCENARIO_KEY_STRING][a][DELIV_KEY_STRING]) -\r\n        d3.max(data[objective][SCENARIO_KEY_STRING][b][DELIV_KEY_STRING])\r\n    );\r\n  }\r\n}\r\n","import RecursiveDropletsBasicApp from \"./RecursiveDropletsBasicApp\";\r\n\r\nexport default function RecusiveDropletsWatercolorApp() {\r\n  return <RecursiveDropletsBasicApp watercolor />;\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useRef } from \"react\";\r\n\r\nexport function ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nexport function bucketPath(width, height, filled = 1.0, taper = 0.8) {\r\n  let bottomRight = width * taper + (width * (1 - taper)) / 2,\r\n    bottomLeft = (width * (1 - taper)) / 2;\r\n  let data = [\r\n    {\r\n      x: d3.interpolate(bottomRight, width)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n    { x: bottomRight, y: height },\r\n    { x: bottomLeft, y: height },\r\n    {\r\n      x: d3.interpolate(bottomLeft, 0)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n  ];\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d.x;\r\n    })\r\n    .y(function (d) {\r\n      return d.y;\r\n    });\r\n  return lineFunc(data) + \"z\";\r\n}\r\n\r\nexport function quantileBins(numericBins, unitsPerQuantile, maxQuantiles) {\r\n  let quantileBins = numericBins.map((bin) =>\r\n    Math.round(bin.length / unitsPerQuantile)\r\n  );\r\n  let sum = d3.sum(quantileBins);\r\n\r\n  while (sum > maxQuantiles) {\r\n    quantileBins[\r\n      d3.minIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : Infinity\r\n      )\r\n    ] -= 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  while (sum < maxQuantiles) {\r\n    quantileBins[\r\n      d3.maxIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : -Infinity\r\n      )\r\n    ] += 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  return quantileBins;\r\n}\r\n\r\n// https://www.developerway.com/posts/implementing-advanced-use-previous-hook\r\nexport function usePrevious(value, isEqualFunc) {\r\n  // initialise the ref with previous and current values\r\n  const ref = useRef({\r\n    value: value,\r\n    prev: null,\r\n  });\r\n\r\n  const current = ref.current.value;\r\n\r\n  // if the value passed into hook doesn't match what we store as \"current\"\r\n  // move the \"current\" to the \"previous\"\r\n  // and store the passed value as \"current\"\r\n  if (isEqualFunc ? !isEqualFunc(value, current) : value !== current) {\r\n    ref.current = {\r\n      value: value,\r\n      prev: current,\r\n    };\r\n  }\r\n\r\n  // return the previous value only\r\n  return ref.current.prev;\r\n}\r\n","import { mapBy } from \"../utils\";\r\n\r\nexport const MAX_DELIVS = 1200;\r\nexport const SCENARIO_KEY_STRING = \"scens\";\r\nexport const DELIV_KEY_STRING = \"delivs\";\r\n\r\nexport const objectivesData = await (async function () {\r\n  const objs = await (await fetch(\"./all_objectives.json\")).json();\r\n\r\n  for (const obj of objs) {\r\n    for (const scen of obj[SCENARIO_KEY_STRING]) {\r\n      scen[DELIV_KEY_STRING] = scen[DELIV_KEY_STRING].map((v) =>\r\n        Math.min(Math.max(0, v), MAX_DELIVS)\r\n      ).sort((a, b) => b - a);\r\n    }\r\n    // obj[SCENARIO_KEY_STRING] = obj[SCENARIO_KEY_STRING].slice(0, 100);\r\n    obj[SCENARIO_KEY_STRING] = mapBy(\r\n      obj[SCENARIO_KEY_STRING],\r\n      ({ name }) => name\r\n    );\r\n  }\r\n\r\n  console.log(\"DATA: loading objectives data\");\r\n\r\n  return mapBy(objs, ({ obj }) => obj);\r\n})();\r\n","import * as d3 from \"d3\";\r\nimport Matter from \"matter-js\";\r\n\r\n// when fn is `({ name }) => name`, turns\r\n//\r\n//  [\r\n//    { name: \"Zeta\", age: 30 },\r\n//    { name: \"Aloy\", age: 40 },\r\n//  ];\r\n//\r\n// to\r\n//\r\n//  {\r\n//    \"Zeta\": { name: \"Zeta\", age: 30 },\r\n//    \"Aloy\": { name: \"Aloy\", age: 40 },\r\n//  };\r\nexport function mapBy(objs, fn) {\r\n  const newObjs = Object.groupBy(objs, fn);\r\n\r\n  for (const key of Object.keys(newObjs)) {\r\n    newObjs[key] = newObjs[key][0];\r\n  }\r\n\r\n  return newObjs;\r\n}\r\n\r\nexport const WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.sqrt(2) / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\nexport function percentToRatioFilled(p) {\r\n  return (3.1304 * p ** 3 - 4.2384 * p ** 2 + 3.3471 * p + 0.0298) / 2.4;\r\n}\r\n\r\nexport function kernelDensityEstimator(kernel, X) {\r\n  return function (V) {\r\n    return X.map(function (x) {\r\n      return [\r\n        x,\r\n        d3.mean(V, function (v) {\r\n          return kernel(x - v);\r\n        }),\r\n      ];\r\n    });\r\n  };\r\n}\r\n\r\nexport function kernelEpanechnikov(k) {\r\n  return function (v) {\r\n    return Math.abs((v /= k)) <= 1 ? (0.75 * (1 - v * v)) / k : 0;\r\n  };\r\n}\r\n\r\nfunction generateWaterdrop(width) {\r\n  const rad = width / 2;\r\n  const partitions = 20;\r\n  const delta = (Math.PI * 3) / 2 / partitions;\r\n\r\n  const outer = [\r\n    {\r\n      x: Math.cos((Math.PI * 5) / 4) * rad,\r\n      y: Math.sin((Math.PI * 5) / 4) * rad,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: -Math.SQRT2 * rad,\r\n    },\r\n  ];\r\n\r\n  for (let i = 0; i <= partitions; i++) {\r\n    outer.push({\r\n      x: Math.cos(i * delta - Math.PI / 4) * rad,\r\n      y: Math.sin(i * delta - Math.PI / 4) * rad,\r\n    });\r\n  }\r\n\r\n  return outer;\r\n}\r\n\r\nexport function generateRandoPoints(shape, count) {\r\n  const bounds = Matter.Bounds.create(shape);\r\n\r\n  const minX = bounds.min.x,\r\n    maxX = bounds.max.x,\r\n    minY = bounds.min.y,\r\n    maxY = bounds.max.y;\r\n\r\n  const genX = d3.scaleLinear([minX, maxX]);\r\n  const genY = d3.scaleLinear([minY, maxY]);\r\n\r\n  const points = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    while (true) {\r\n      const x = genX(Math.random());\r\n      const y = genY(Math.random());\r\n\r\n      if (Matter.Vertices.contains(shape, { x, y })) {\r\n        points.push([x, y]);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\n// inner diameter of 1\r\nexport const WATERDROP_CAGE_COORDS = (function () {\r\n  const outer = generateWaterdrop(1.4);\r\n  const inner = generateWaterdrop(1);\r\n\r\n  const coords = [];\r\n\r\n  for (let i = 0; i < outer.length - 1; i++) {\r\n    coords.push([outer[i], outer[i + 1], inner[i + 1], inner[i]]);\r\n  }\r\n\r\n  return coords;\r\n})();\r\n\r\nlet RANDO_CACHE;\r\n\r\n// assuming nodes is already ordered and first nodes are going to be put on the bottom\r\nexport function placeDropsUsingPhysics(x, y, nodes) {\r\n  // first generate random points within water droplet. we can stop here, but points might not be the most uniformly distributed\r\n  RANDO_CACHE =\r\n    RANDO_CACHE || generateRandoPoints(generateWaterdrop(1), nodes.length);\r\n\r\n  const DELTA = d3.mean(nodes.map(({ r }) => r * 2));\r\n  const WIDTH_AREA = DELTA * Math.floor(Math.sqrt(nodes.length));\r\n\r\n  const randoPoints = RANDO_CACHE.map(([x, y]) => [\r\n    (x * WIDTH_AREA) / 2,\r\n    (y * WIDTH_AREA) / 2,\r\n  ]);\r\n\r\n  // thus, we use physics engine to take care of distributing the points evenly and based on radius\r\n  const Engine = Matter.Engine,\r\n    Bodies = Matter.Bodies,\r\n    Composite = Matter.Composite;\r\n\r\n  const engine = Engine.create();\r\n\r\n  const nodePos = randoPoints.sort((a, b) => b[1] - a[1]);\r\n\r\n  const node_bodies = nodes.map(({ r, id }, i) => {\r\n    const [nx, ny] = nodePos[i];\r\n    return Bodies.circle(nx + x, ny + y, r * 2, {\r\n      restitution: 0,\r\n      id: id,\r\n    });\r\n  });\r\n\r\n  const parts = WATERDROP_CAGE_COORDS.map((quad) =>\r\n    Matter.Body.create({\r\n      position: Matter.Vertices.centre(quad),\r\n      vertices: quad,\r\n      isStatic: true,\r\n    })\r\n  );\r\n\r\n  const cage = Matter.Body.create({\r\n    isStatic: true,\r\n  });\r\n\r\n  Matter.Body.setParts(cage, parts);\r\n  Matter.Body.scale(cage, WIDTH_AREA * 1.4, WIDTH_AREA * 1.4);\r\n  Matter.Body.translate(cage, { x, y: y + (WIDTH_AREA / 2) * 0.4 });\r\n\r\n  Composite.add(engine.world, [...node_bodies, cage]);\r\n\r\n  // run engine for 1 second at 60 fps\r\n  for (let i = 0, FPS = 60; i < FPS * 1; i++) Engine.update(engine, 1000 / FPS);\r\n\r\n  return node_bodies.map(({ position, id }) => ({\r\n    id,\r\n    x: position.x,\r\n    y: position.y,\r\n  }));\r\n}\r\n\r\n// https://gist.github.com/mbostock/5743979\r\nexport function bounce(h) {\r\n  if (!arguments.length) h = 0.25;\r\n  var b0 = 1 - h,\r\n    b1 = b0 * (1 - b0) + b0,\r\n    b2 = b0 * (1 - b1) + b1,\r\n    x0 = 2 * Math.sqrt(h),\r\n    x1 = x0 * Math.sqrt(h),\r\n    x2 = x1 * Math.sqrt(h),\r\n    t0 = 1 / (1 + x0 + x1 + x2),\r\n    t1 = t0 + t0 * x0,\r\n    t2 = t1 + t0 * x1,\r\n    m0 = t0 + (t0 * x0) / 2,\r\n    m1 = t1 + (t0 * x1) / 2,\r\n    m2 = t2 + (t0 * x2) / 2,\r\n    a = 1 / (t0 * t0);\r\n  return function (t) {\r\n    return t >= 1\r\n      ? 1\r\n      : t < t0\r\n      ? a * t * t\r\n      : t < t1\r\n      ? a * (t -= m0) * t + b0\r\n      : t < t2\r\n      ? a * (t -= m1) * t + b1\r\n      : a * (t -= m2) * t + b2;\r\n  };\r\n}\r\n"],"names":["LEVELS","DEFAULT_OBJECTIVE_IDX","RAD_PX","DROPLET_SHAPE","SVG_DROPLET_WIDTH_DONT_CHANGE","RecursiveDropletsBasicApp","_ref","watercolor","current","objectiveIDs","useRef","Object","keys","objectivesData","winDim","curObjectiveIdx","setCurObjectiveIdx","useState","normalize","setNormalize","bucketSvgSelector","orderedScenIDs","useMemo","criteriaSort","waterLevels","map","s","i","createInterps","ticksExact","d","reverse","useLayoutEffect","width","window","innerWidth","height","innerHeight","attr","scale","d3","l","nodes","placeDropsUsingPhysics","levs","idx","r","id","_ref2","x","y","w","maxLev","tilt","Math","random","dur","startX","startY","endX","endY","selectAll","data","_","join","enter","append","call","each","_ref3","this","concat","_ref4","_ref5","select","style","percentToRatioFilled","SQRT2","transition","duration","_ref6","delay","floor","ease","_ref7","_ref8","_ref9","_jsxs","className","children","_jsx","value","onChange","e","parseInt","target","objectiveID","name","type","checked","htmlFor","ref","curScen","delivs","SCENARIO_KEY_STRING","DELIV_KEY_STRING","domain","length","range","v","min","clamp","criteria","objective","sort","a","b","RecusiveDropletsWatercolorApp","start","stop","count","bucketPath","filled","arguments","undefined","taper","bottomRight","bottomLeft","lineFunc","quantileBins","numericBins","unitsPerQuantile","maxQuantiles","bin","round","sum","Infinity","usePrevious","isEqualFunc","prev","MAX_DELIVS","async","objs","fetch","json","obj","scen","max","mapBy","console","log","fn","newObjs","groupBy","key","WATERDROP_ICON","draw","context","size","moveTo","lineTo","arc","sqrt","PI","closePath","p","kernelDensityEstimator","kernel","X","V","kernelEpanechnikov","k","abs","generateWaterdrop","rad","delta","outer","cos","sin","push","WATERDROP_CAGE_COORDS","inner","coords","RANDO_CACHE","shape","bounds","Matter","create","minX","maxX","minY","maxY","genX","genY","points","contains","generateRandoPoints","WIDTH_AREA","randoPoints","Engine","Bodies","Composite","engine","nodePos","node_bodies","nx","ny","circle","restitution","parts","quad","position","centre","vertices","isStatic","cage","setParts","translate","add","world","FPS","update"],"sourceRoot":""}