{"version":3,"file":"static/js/397.11876b69.chunk.js","mappings":"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","sources":["ExplanationAnimApp.jsx","bucket-lib/BucketGlyph.jsx","bucket-lib/utils.js","data/objectivesData.jsx","utils.js"],"sourcesContent":["import React, { useEffect, useLayoutEffect, useRef, useState } from \"react\";\r\nimport * as d3 from \"d3\";\r\nimport {\r\n  DELIV_KEY_STRING,\r\n  DELIV_KEY_STRING_UNORD,\r\n  MAX_DELIVS,\r\n  SCENARIO_KEY_STRING,\r\n  objectiveIDs,\r\n  objectivesData,\r\n} from \"./data/objectivesData\";\r\nimport BucketGlyph from \"./bucket-lib/BucketGlyph\";\r\nimport { interpolateWatercolorBlue, ticksExact } from \"./bucket-lib/utils\";\r\n\r\nconst DEFAULT_SCENARIO = \"expl0595\";\r\nconst DEFAULT_OBJECTIVE = \"C_STANGDWN_MIF\";\r\nconst DATE_START = 1930;\r\n\r\nexport default function ExplanationAnimApp() {\r\n  const [curObjective, setCurObjective] = useState(DEFAULT_OBJECTIVE);\r\n\r\n  const [slide, setSlide] = useState(-1);\r\n  const lastSlide = useRef();\r\n  const slideFns = useRef([]);\r\n\r\n  const svgElement = useRef();\r\n  const [bucketInterper, setBucketInterper] = useState(() => d3.scaleLinear());\r\n\r\n  const width = 800,\r\n    height = 400;\r\n\r\n  const margin = { top: 30, right: 30, bottom: 30, left: 60 };\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = d3.select(svgElement.current);\r\n\r\n    svgContainer.selectAll(\"*\").remove();\r\n    document.querySelector(\".bucket-wrapper\").style.display = \"none\";\r\n\r\n    const svgGroup = svgContainer\r\n      .attr(\"width\", width + margin.left + margin.right)\r\n      .attr(\"height\", height + margin.top + margin.bottom)\r\n      .style(\"background\", \"rgb(251, 251, 255)\")\r\n      .attr(\"opacity\", 1)\r\n      .append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},${margin.top})`);\r\n\r\n    const dataDescending = objectivesData[curObjective][SCENARIO_KEY_STRING][\r\n      DEFAULT_SCENARIO\r\n    ][DELIV_KEY_STRING_UNORD].map((val, placeFromLeft) => ({\r\n      val,\r\n      placeFromLeft,\r\n      year: placeFromLeft + DATE_START,\r\n    })).sort((a, b) => b.val - a.val);\r\n\r\n    setBucketInterper(() =>\r\n      d3\r\n        .scaleLinear()\r\n        .domain(ticksExact(0, 1, dataDescending.length))\r\n        .range(\r\n          objectivesData[curObjective][SCENARIO_KEY_STRING][DEFAULT_SCENARIO][\r\n            DELIV_KEY_STRING\r\n          ].map((v) => v / MAX_DELIVS)\r\n        )\r\n        .clamp(true)\r\n    );\r\n\r\n    const x = d3\r\n      .scaleBand()\r\n      .domain(dataDescending.map(({ year }) => year).sort())\r\n      .range([0, width])\r\n      .padding(0.4);\r\n    const y = d3.scaleLinear().domain([0, MAX_DELIVS]).range([height, 0]);\r\n\r\n    const xaxis = d3\r\n      .axisBottom(x)\r\n      .tickSize(0)\r\n      .tickValues(x.domain().filter((_, i) => i % 10 === 0));\r\n\r\n    svgGroup\r\n      .append(\"g\")\r\n      .attr(\"class\", \"anim-xaxis\")\r\n      .attr(\"opacity\", 1)\r\n      .attr(\"transform\", `translate(0, ${height})`)\r\n      .call(xaxis)\r\n      .selectAll(\"text\")\r\n      .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\r\n      .style(\"text-anchor\", \"end\");\r\n    svgGroup.append(\"g\").call(d3.axisLeft(y));\r\n\r\n    slideFns.current[0] = () => {\r\n      svgGroup\r\n        .selectAll(\".bars\")\r\n        .data(dataDescending, (d) => d.placeFromLeft)\r\n        .join(\"rect\")\r\n        .attr(\"class\", \"bars\")\r\n        .attr(\"x\", (d) => x(d.year))\r\n        .attr(\"y\", height)\r\n        .attr(\"width\", x.bandwidth())\r\n        .attr(\"height\", 0)\r\n        .attr(\"opacity\", 1)\r\n        .attr(\"fill\", \"steelblue\")\r\n        .transition()\r\n        .duration(500)\r\n        .delay((d) => d.placeFromLeft * 10)\r\n        .attr(\"y\", (d) => y(d.val))\r\n        .attr(\"height\", (d) => height - y(d.val));\r\n    };\r\n\r\n    slideFns.current[1] = async () => {\r\n      const finalWidth = width / 8;\r\n\r\n      svgGroup.select(\".anim-xaxis\").call(xaxis.tickFormat(\"\"));\r\n\r\n      const bars = svgGroup.selectAll(\".bars\");\r\n\r\n      await bars\r\n        .style(\"mix-blend-mode\", \"multiply\")\r\n        .transition()\r\n        .duration(500)\r\n        .attr(\"opacity\", 0.05)\r\n        .transition()\r\n        .delay(\r\n          (d) =>\r\n            100 +\r\n            (1 - (1 - d.placeFromLeft / dataDescending.length) ** 4) * 1000\r\n        )\r\n        .duration(500)\r\n        .attr(\"width\", finalWidth)\r\n        .attr(\"x\", (d) => width / 2 - finalWidth / 2)\r\n        .end();\r\n\r\n      svgGroup\r\n        .select(\".anim-xaxis\")\r\n        .transition()\r\n        .transition(500)\r\n        .attr(\"transform\", `translate(0, ${height + 50})`)\r\n        .attr(\"opacity\", 0);\r\n\r\n      bars.transition().delay(500).attr(\"x\", 0);\r\n\r\n      svgGroup\r\n        .transition()\r\n        .delay(500)\r\n        .attr(\r\n          \"transform\",\r\n          `translate(${margin.left + width / 2 - finalWidth / 2},${margin.top})`\r\n        );\r\n    };\r\n\r\n    slideFns.current[2] = () => {\r\n      svgGroup\r\n        .selectAll(\".bars\")\r\n        .style(\"mix-blend-mode\", \"normal\")\r\n        .attr(\"fill\", (_, i) =>\r\n          interpolateWatercolorBlue(i / (dataDescending.length - 1))\r\n        )\r\n        .transition()\r\n        .attr(\"opacity\", 1);\r\n    };\r\n\r\n    slideFns.current[3] = () => {\r\n      document.querySelector(\".bucket-wrapper\").style.display = \"initial\";\r\n      svgContainer.transition().duration(500).attr(\"opacity\", 0);\r\n    };\r\n\r\n    const handleClick = () => {\r\n      setSlide((p) => p + 1);\r\n    };\r\n\r\n    svgContainer.node().addEventListener(\"click\", handleClick);\r\n\r\n    return () => {\r\n      svgContainer.node().removeEventListener(\"click\", handleClick);\r\n\r\n      setSlide(-1);\r\n    };\r\n  }, [curObjective]);\r\n\r\n  useEffect(() => {\r\n    if (slide === -1) {\r\n      setSlide(0);\r\n      lastSlide.current = -1;\r\n      return;\r\n    }\r\n\r\n    if (lastSlide.current < slide && slide < slideFns.current.length) {\r\n      slideFns.current[slide]();\r\n      lastSlide.current = slide;\r\n    }\r\n  }, [slide]);\r\n\r\n  return (\r\n    <div className=\"explanation-anim-wrapper\">\r\n      <select\r\n        value={curObjective}\r\n        onChange={(e) => setCurObjective(e.target.value)}\r\n      >\r\n        {objectiveIDs.map((objectiveID) => (\r\n          <option value={objectiveID} key={objectiveID}>\r\n            {objectiveID}\r\n          </option>\r\n        ))}\r\n      </select>\r\n      <svg ref={svgElement}></svg>\r\n      <BucketGlyph levelInterp={bucketInterper} width={300} height={height} />\r\n      <p>\r\n        We turn yearly water delivery quantities into a heatmap-like\r\n        representation, where darker blue indicates ranges of likely quantities\r\n        and lighter blue indicates ranges of less likely quantities. This works\r\n        well with the metaphor of a water bucket, since we can imagine water\r\n        deliveries as levels of water filled in a bucket; darker blue water\r\n        levels represent how much water we can expect AT LEAST, with lighter\r\n        blue water levels represent various less likely, but still plausible,\r\n        water delivery quantities.\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useId, useLayoutEffect, useMemo, useRef } from \"react\";\r\nimport {\r\n  bucketPath,\r\n  interpolateWatercolorBlue,\r\n  ticksExact,\r\n  usePrevious,\r\n} from \"./utils\";\r\n\r\nconst DEGREE_SWAY = 40;\r\nconst LEVELS = 10;\r\nconst LINE_WIDTH = 3;\r\n\r\nexport default function BucketGlyph({\r\n  levelInterp,\r\n  colorInterp = interpolateWatercolorBlue,\r\n  width = 200,\r\n  height = 400,\r\n  resolution = LEVELS,\r\n}) {\r\n  const id = useId();\r\n  const svgSelector = useRef();\r\n\r\n  const liquidLevels = useMemo(\r\n    () =>\r\n      ticksExact(0, 1 - 1 / resolution, resolution).map((d) => levelInterp(d)),\r\n    [levelInterp, resolution]\r\n  );\r\n\r\n  const prevLiquidLevels = usePrevious(liquidLevels);\r\n\r\n  const innerWidth = width - LINE_WIDTH * 2;\r\n  const innerHeight = height - LINE_WIDTH;\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .append(\"g\")\r\n      .attr(\"class\", \"svg-container\")\r\n      .attr(\"transform\", `translate(${LINE_WIDTH}, ${LINE_WIDTH / 2})`);\r\n\r\n    svgContainer\r\n      .append(\"defs\")\r\n      .append(\"clipPath\")\r\n      .attr(\"id\", \"bucket-mask-\" + id)\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-mask-path\");\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .attr(\"class\", \"graph-area\")\r\n      .attr(\"clip-path\", `url(#bucket-mask-${id})`);\r\n\r\n    svgContainer\r\n      .append(\"g\")\r\n      .append(\"path\")\r\n      .attr(\"class\", \"bucket-outline\")\r\n      .attr(\"stroke\", \"lightgray\")\r\n      .attr(\"stroke-linecap\", \"round\")\r\n      .attr(\"stroke-width\", LINE_WIDTH)\r\n      .attr(\"fill\", \"none\");\r\n  }, [id]); // id shouldn't change, basically empty dependency array\r\n\r\n  useLayoutEffect(() => {\r\n    const svgContainer = svgSelector.current\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .select(\".svg-container\");\r\n\r\n    svgContainer\r\n      .select(\".bucket-mask-path\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight));\r\n\r\n    svgContainer\r\n      .select(\".bucket-outline\")\r\n      .attr(\"d\", bucketPath(innerWidth, innerHeight).split(\"z\")[0]);\r\n  }, [width, height, innerWidth, innerHeight]);\r\n\r\n  useLayoutEffect(() => {\r\n    const liquids = svgSelector.current\r\n      .select(\".graph-area\")\r\n      .selectAll(\".bucketBox\")\r\n      .data(liquidLevels)\r\n      .join(\"rect\")\r\n      .attr(\"class\", \"bucketBox\")\r\n      .attr(\"width\", innerWidth * 2)\r\n      .attr(\"height\", innerHeight * 2)\r\n      .attr(\"x\", -innerWidth / 2)\r\n      .attr(\"fill\", (_, i) => colorInterp(i / (resolution - 1)));\r\n\r\n    liquids\r\n      .transition(\"liquidLevel\")\r\n      .ease(d3.easeElasticOut.period(0.6))\r\n      .delay((_, i) => i * (100 / resolution))\r\n      .duration(1000)\r\n      .attr(\"y\", (d) => innerHeight - d * innerHeight);\r\n\r\n    liquids\r\n      .transition(\"liquidSway\")\r\n      .duration(2000)\r\n      .delay((_, i) => i * 10)\r\n      .ease(d3.easeQuad)\r\n      .attrTween(\"transform\", function (d, i) {\r\n        const diff = prevLiquidLevels ? Math.abs(prevLiquidLevels[i] - d) : 0;\r\n        return (t) =>\r\n          `rotate(${\r\n            Math.sin(\r\n              Math.min((Math.PI * 4 * t) / (0.5 * diff + 0.5), Math.PI * 4)\r\n            ) *\r\n            diff *\r\n            DEGREE_SWAY *\r\n            (1 - t)\r\n          }, ${innerWidth / 2}, ${0})`;\r\n      });\r\n  }, [\r\n    liquidLevels,\r\n    prevLiquidLevels,\r\n    width,\r\n    height,\r\n    innerWidth,\r\n    innerHeight,\r\n    resolution,\r\n    colorInterp,\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"bucket-wrapper\">\r\n      <svg ref={(e) => void (svgSelector.current = d3.select(e))}></svg>\r\n    </div>\r\n  );\r\n}\r\n","import * as d3 from \"d3\";\r\nimport { useRef } from \"react\";\r\n\r\n// inclusive\r\nexport function ticksExact(start, stop, count) {\r\n  return d3.range(count).map((i) => (i / (count - 1)) * (stop - start) + start);\r\n}\r\n\r\nexport function bucketPath(width, height, filled = 1.0, taper = 0.8) {\r\n  let bottomRight = width * taper + (width * (1 - taper)) / 2,\r\n    bottomLeft = (width * (1 - taper)) / 2;\r\n  let data = [\r\n    {\r\n      x: d3.interpolate(bottomRight, width)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n    { x: bottomRight, y: height },\r\n    { x: bottomLeft, y: height },\r\n    {\r\n      x: d3.interpolate(bottomLeft, 0)(filled),\r\n      y: d3.interpolate(height, 0)(filled),\r\n    },\r\n  ];\r\n  let lineFunc = d3\r\n    .line()\r\n    .x(function (d) {\r\n      return d.x;\r\n    })\r\n    .y(function (d) {\r\n      return d.y;\r\n    });\r\n  return lineFunc(data) + \"z\";\r\n}\r\n\r\nexport function quantileBins(numericBins, unitsPerQuantile, maxQuantiles) {\r\n  let quantileBins = numericBins.map((bin) =>\r\n    Math.round(bin.length / unitsPerQuantile)\r\n  );\r\n  let sum = d3.sum(quantileBins);\r\n\r\n  while (sum > maxQuantiles) {\r\n    quantileBins[\r\n      d3.minIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : Infinity\r\n      )\r\n    ] -= 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  while (sum < maxQuantiles) {\r\n    quantileBins[\r\n      d3.maxIndex(numericBins, (d, i) =>\r\n        d.length !== 0\r\n          ? d.length / unitsPerQuantile - quantileBins[i]\r\n          : -Infinity\r\n      )\r\n    ] += 1;\r\n\r\n    sum = d3.sum(quantileBins);\r\n  }\r\n\r\n  return quantileBins;\r\n}\r\n\r\n// https://www.developerway.com/posts/implementing-advanced-use-previous-hook\r\nexport function usePrevious(value, isEqualFunc) {\r\n  // initialise the ref with previous and current values\r\n  const ref = useRef({\r\n    value: value,\r\n    prev: null,\r\n  });\r\n\r\n  const current = ref.current.value;\r\n\r\n  // if the value passed into hook doesn't match what we store as \"current\"\r\n  // move the \"current\" to the \"previous\"\r\n  // and store the passed value as \"current\"\r\n  if (isEqualFunc ? !isEqualFunc(value, current) : value !== current) {\r\n    ref.current = {\r\n      value: value,\r\n      prev: current,\r\n    };\r\n  }\r\n\r\n  // return the previous value only\r\n  return ref.current.prev;\r\n}\r\n\r\nexport const interpolateWatercolorBlue = (i) =>\r\n  d3.interpolateBlues(d3.scaleLinear([0.2, 1.0])(i));\r\n","import { mapBy } from \"../utils\";\r\n\r\nexport const MAX_DELIVS = 1200;\r\nexport const SCENARIO_KEY_STRING = \"scens\";\r\nexport const DELIV_KEY_STRING = \"delivs\";\r\nexport const DELIV_KEY_STRING_UNORD = \"delivs_unord\";\r\n\r\nexport const objectivesData = await (async function () {\r\n  const objs = await (await fetch(\"./all_objectives.json\")).json();\r\n\r\n  for (const obj of objs) {\r\n    obj[SCENARIO_KEY_STRING] = obj[SCENARIO_KEY_STRING];\r\n    for (const scen of obj[SCENARIO_KEY_STRING]) {\r\n      // data cleanup, clamping\r\n      const unord = scen[DELIV_KEY_STRING].map((v) =>\r\n        Math.min(Math.max(0, v), MAX_DELIVS)\r\n      );\r\n\r\n      scen[DELIV_KEY_STRING_UNORD] = unord;\r\n      scen[DELIV_KEY_STRING] = Array.from(unord).sort((a, b) => b - a);\r\n    }\r\n    obj[SCENARIO_KEY_STRING] = mapBy(\r\n      obj[SCENARIO_KEY_STRING],\r\n      ({ name }) => name\r\n    );\r\n  }\r\n\r\n  console.log(\"DATA: loading objectives data\");\r\n\r\n  return mapBy(objs, ({ obj }) => obj);\r\n})();\r\n\r\nexport const objectiveIDs = Object.keys(objectivesData);\r\nexport const scenarioIDs = Object.keys(\r\n  Object.values(objectivesData)[0][SCENARIO_KEY_STRING]\r\n);\r\n","import * as THREE from \"three\";\r\nimport * as d3 from \"d3\";\r\nimport Matter from \"matter-js\";\r\nimport {\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useReducer,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { DELIV_KEY_STRING, SCENARIO_KEY_STRING } from \"./data/objectivesData\";\r\nimport { ticksExact } from \"./bucket-lib/utils\";\r\n\r\nexport function clamp(x, a, b) {\r\n  return Math.max(a, Math.min(b, x));\r\n}\r\n\r\n// when fn is `({ name }) => name`, turns\r\n//\r\n//  [\r\n//    { name: \"Zeta\", age: 30 },\r\n//    { name: \"Aloy\", age: 40 },\r\n//  ];\r\n//\r\n// to\r\n//\r\n//  {\r\n//    \"Zeta\": { name: \"Zeta\", age: 30 },\r\n//    \"Aloy\": { name: \"Aloy\", age: 40 },\r\n//  };\r\nexport function mapBy(objs, fn) {\r\n  const newObjs = Object.groupBy(objs, fn);\r\n\r\n  for (const key of Object.keys(newObjs)) {\r\n    newObjs[key] = newObjs[key][0];\r\n  }\r\n\r\n  return newObjs;\r\n}\r\n\r\n// size is height of waterdrop plus a bit more (1/2 of size is distance from top of drop to center of circle part)\r\nexport const WATERDROP_ICON = {\r\n  draw: function (context, size) {\r\n    context.moveTo(0, -size / 2);\r\n    context.lineTo(size / 4, -size / 4);\r\n\r\n    context.arc(0, 0, size / Math.SQRT2 / 2, -Math.PI / 4, (Math.PI * 5) / 4);\r\n    context.lineTo(0, -size / 2);\r\n    context.closePath();\r\n  },\r\n};\r\n\r\n// path generated when WATERDROP_ICON size = 2\r\nexport const DROPLET_SHAPE = \"M0,-1L0.5,-0.5A0.707,0.707,0,1,1,-0.5,-0.5L0,-1Z\";\r\n\r\nexport function percentToRatioFilled(p) {\r\n  p -= 0.0088;\r\n  return Math.min(\r\n    1,\r\n    Math.max(\r\n      0,\r\n      (3.1304 * p ** 3 - 4.2384 * p ** 2 + 3.3471 * p + 0.0298) / 2.2326\r\n    )\r\n  );\r\n}\r\n\r\nconst CIRC_RAD = Math.SQRT1_2;\r\nconst DROP_RAD = 1;\r\nconst CIRC_HEIGHT = CIRC_RAD + CIRC_RAD;\r\nconst DROP_HEIGHT = DROP_RAD + CIRC_RAD;\r\nconst HAT_START = 0.75;\r\n\r\n// half width at widest is 1\r\nfunction yToHalfWidth(y) {\r\n  if (y >= HAT_START) {\r\n    const hatHalfWidth = Math.SQRT1_2;\r\n\r\n    return (hatHalfWidth * (1 - y)) / (1 - HAT_START);\r\n  }\r\n\r\n  const circFrac = fracDropToCirc(y);\r\n  const trigX = (1 - circFrac) * 2 - 1;\r\n\r\n  const angle = Math.acos(trigX);\r\n  const trigY = Math.sin(angle);\r\n\r\n  return trigY;\r\n}\r\n\r\n// fml, here sprite width is 2 (i.e. circ rad is 1) thus drop real height is 1 + sqrt2\r\nfunction yToSpriteY(y) {\r\n  return (y - CIRC_RAD / DROP_HEIGHT) * (1 + Math.SQRT2);\r\n}\r\n\r\nfunction spriteYToY(sy) {\r\n  return sy / (1 + Math.SQRT2) + CIRC_RAD / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracCircToDrop(v) {\r\n  return v / CIRC_HEIGHT / DROP_HEIGHT;\r\n}\r\n\r\nfunction fracDropToCirc(v) {\r\n  return v / (CIRC_HEIGHT / DROP_HEIGHT);\r\n}\r\n\r\nexport function waterdropDeltaOutline(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const rightCoords = [];\r\n  const leftCoords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    rightCoords.push(v2, v3);\r\n    leftCoords.push(v1, v4);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  rightCoords.push(v2, v3);\r\n  leftCoords.push(v1, v4);\r\n\r\n  rightCoords.push(...leftCoords.reverse());\r\n\r\n  return rightCoords;\r\n}\r\n\r\nexport function waterdropDelta(yStart, yEnd, size = 2) {\r\n  if (Math.abs(yStart - yEnd) < 0.01) return [];\r\n\r\n  const rad = (size / 2 / DROP_RAD) * CIRC_RAD;\r\n\r\n  const Y_DELTA = 0.1;\r\n\r\n  const coords = [];\r\n\r\n  let dx1, dy1, dx2, dy2;\r\n\r\n  for (let i = 1; i <= Math.ceil(1 / Y_DELTA); i++) {\r\n    dx1 = yToHalfWidth(yStart + (i - 1) * Y_DELTA);\r\n    dy1 = yToSpriteY(yStart + (i - 1) * Y_DELTA);\r\n    dx2 = yToHalfWidth(yStart + i * Y_DELTA);\r\n    dy2 = yToSpriteY(yStart + i * Y_DELTA);\r\n\r\n    if (spriteYToY(dy2) >= yEnd) break;\r\n\r\n    // CC !\r\n    const v1 = [-dx1 * rad, -dy1 * rad],\r\n      v2 = [dx1 * rad, -dy1 * rad],\r\n      v3 = [dx2 * rad, -dy2 * rad],\r\n      v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n    coords.push([v1, v2, v3]);\r\n    coords.push([v1, v3, v4]);\r\n  }\r\n\r\n  dx2 = yToHalfWidth(yEnd);\r\n  dy2 = yToSpriteY(yEnd);\r\n\r\n  // CC !\r\n  const v1 = [-dx1 * rad, -dy1 * rad],\r\n    v2 = [dx1 * rad, -dy1 * rad],\r\n    v3 = [dx2 * rad, -dy2 * rad],\r\n    v4 = [-dx2 * rad, -dy2 * rad];\r\n\r\n  coords.push([v1, v2, v3]);\r\n  coords.push([v1, v3, v4]);\r\n\r\n  return coords;\r\n}\r\n\r\nexport function waterdrop(yFill, size = 2) {\r\n  if (yFill === 0) return [];\r\n\r\n  return waterdropDelta(0, yFill, size);\r\n}\r\n\r\nexport function kernelDensityEstimator(kernel, X) {\r\n  return function (V) {\r\n    return X.map(function (x) {\r\n      return [\r\n        x,\r\n        d3.mean(V, function (v) {\r\n          return kernel(x - v);\r\n        }),\r\n      ];\r\n    });\r\n  };\r\n}\r\n\r\nexport function kernelEpanechnikov(k) {\r\n  return function (v) {\r\n    return Math.abs((v /= k)) <= 1 ? (0.75 * (1 - v * v)) / k : 0;\r\n  };\r\n}\r\n\r\nfunction generateWaterdrop(width) {\r\n  const rad = width / 2;\r\n  const partitions = 16;\r\n  const delta = (Math.PI * 3) / 2 / partitions;\r\n\r\n  const outer = [\r\n    {\r\n      x: Math.cos((Math.PI * 5) / 4) * rad,\r\n      y: Math.sin((Math.PI * 5) / 4) * rad,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: -Math.SQRT2 * rad,\r\n    },\r\n  ];\r\n\r\n  for (let i = 0; i <= partitions; i++) {\r\n    outer.push({\r\n      x: Math.cos(i * delta - Math.PI / 4) * rad,\r\n      y: Math.sin(i * delta - Math.PI / 4) * rad,\r\n    });\r\n  }\r\n\r\n  return outer;\r\n}\r\n\r\nexport function generateRandoPoints(shape, count) {\r\n  const bounds = Matter.Bounds.create(shape);\r\n\r\n  const minX = bounds.min.x,\r\n    maxX = bounds.max.x,\r\n    minY = bounds.min.y,\r\n    maxY = bounds.max.y;\r\n\r\n  const genX = d3.scaleLinear([minX, maxX]);\r\n  const genY = d3.scaleLinear([minY, maxY]);\r\n\r\n  const points = [];\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    while (true) {\r\n      const x = genX(Math.random());\r\n      const y = genY(Math.random());\r\n\r\n      if (Matter.Vertices.contains(shape, { x, y })) {\r\n        points.push([x, y]);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\n// inner diameter of 1\r\nexport const WATERDROP_CAGE_COORDS = (function () {\r\n  const outer = generateWaterdrop(3);\r\n  const inner = generateWaterdrop(1);\r\n\r\n  const coords = [];\r\n\r\n  for (let i = 0; i < outer.length - 2; i++) {\r\n    coords.push([\r\n      outer[i],\r\n      outer[i + (i < 2 ? 1 : 2)],\r\n      inner[i + (i < 2 ? 1 : 2)],\r\n      inner[i],\r\n    ]);\r\n  }\r\n\r\n  return coords;\r\n})();\r\n\r\nlet RANDO_CACHE;\r\nlet lastNodesLen;\r\n\r\nlet DET_CACHE;\r\nlet lastDetNodesLen;\r\n\r\nexport function radsToDropWidth(nodes) {\r\n  const AREA = d3.sum(nodes.map((r) => r ** 2 * 3.14));\r\n  return Math.floor((Math.sqrt(AREA / 3.14) * 2) / 2);\r\n}\r\n\r\n// assuming nodes is already ordered and first nodes are going to be put on the bottom\r\nexport function placeDropsUsingPhysics(x, y, nodes, reuse = false) {\r\n  if (reuse && DET_CACHE && nodes.length === lastDetNodesLen) return DET_CACHE;\r\n\r\n  // first generate random points within water droplet. we can stop here, but points might not be the most uniformly distributed\r\n\r\n  if (!RANDO_CACHE || nodes.length !== lastNodesLen)\r\n    RANDO_CACHE = d3\r\n      .range(4)\r\n      .map(() =>\r\n        generateRandoPoints(generateWaterdrop(1), (lastNodesLen = nodes.length))\r\n      );\r\n\r\n  const WIDTH_AREA = radsToDropWidth(nodes.map(({ r }) => r));\r\n\r\n  const randoPoints = RANDO_CACHE[\r\n    Math.floor(Math.random() * RANDO_CACHE.length)\r\n  ].map(([x, y]) => [x * WIDTH_AREA, y * WIDTH_AREA]);\r\n\r\n  // thus, we use physics engine to take care of distributing the points evenly and based on radius\r\n  const Engine = Matter.Engine,\r\n    Bodies = Matter.Bodies,\r\n    Composite = Matter.Composite;\r\n\r\n  const engine = Engine.create();\r\n\r\n  const nodePos = randoPoints.sort((a, b) => b[1] - a[1]);\r\n\r\n  const node_bodies = nodes.map(({ r, id }, i) => {\r\n    const [nx, ny] = nodePos[i];\r\n    return Bodies.circle(nx, ny, r, {\r\n      restitution: 0,\r\n      id: id,\r\n    });\r\n  });\r\n\r\n  const parts = WATERDROP_CAGE_COORDS.map((quad) =>\r\n    Matter.Body.create({\r\n      position: Matter.Vertices.centre(quad),\r\n      vertices: quad,\r\n      isStatic: true,\r\n    })\r\n  );\r\n\r\n  const cage = Matter.Body.create({\r\n    isStatic: true,\r\n  });\r\n\r\n  Matter.Body.setParts(cage, parts);\r\n\r\n  Matter.Body.setCentre(cage, { x: 0, y: 0 });\r\n  Matter.Body.scale(cage, WIDTH_AREA, WIDTH_AREA);\r\n\r\n  Composite.add(engine.world, [...node_bodies, cage]);\r\n\r\n  // run engine for SECS second at FPS fps\r\n  for (let i = 0, FPS = 60, SECS = 0.1; i < FPS * SECS; i++)\r\n    Engine.update(engine, 1000 / FPS);\r\n\r\n  const retVal = node_bodies.map(({ position, id }) => ({\r\n    id,\r\n    x: position.x + x,\r\n    y: position.y + y,\r\n  }));\r\n\r\n  retVal.height = (WIDTH_AREA / 2 / CIRC_RAD) * DROP_HEIGHT;\r\n\r\n  if (reuse && (!DET_CACHE || retVal.length !== lastDetNodesLen)) {\r\n    DET_CACHE = retVal;\r\n    lastDetNodesLen = retVal.length;\r\n  }\r\n\r\n  return retVal;\r\n}\r\n\r\n// https://gist.github.com/mbostock/5743979\r\nexport function bounce(h) {\r\n  if (!arguments.length) h = 0.25;\r\n  var b0 = 1 - h,\r\n    b1 = b0 * (1 - b0) + b0,\r\n    b2 = b0 * (1 - b1) + b1,\r\n    x0 = 2 * Math.sqrt(h),\r\n    x1 = x0 * Math.sqrt(h),\r\n    x2 = x1 * Math.sqrt(h),\r\n    t0 = 1 / (1 + x0 + x1 + x2),\r\n    t1 = t0 + t0 * x0,\r\n    t2 = t1 + t0 * x1,\r\n    m0 = t0 + (t0 * x0) / 2,\r\n    m1 = t1 + (t0 * x1) / 2,\r\n    m2 = t2 + (t0 * x2) / 2,\r\n    a = 1 / (t0 * t0);\r\n  return function (t) {\r\n    return t >= 1\r\n      ? 1\r\n      : t < t0\r\n      ? a * t * t\r\n      : t < t1\r\n      ? a * (t -= m0) * t + b0\r\n      : t < t2\r\n      ? a * (t -= m1) * t + b1\r\n      : a * (t -= m2) * t + b2;\r\n  };\r\n}\r\n\r\nexport function rangeInclusive(a, b) {\r\n  return d3.range(a, b + 1);\r\n}\r\n\r\nexport function useStickyScale(defaultVal, scale) {\r\n  const [val, setVal] = useState(defaultVal);\r\n\r\n  const valActual = useMemo(() => scale(val), [val]);\r\n  const setValActual = useCallback((v) => void setVal(scale(v)), []);\r\n\r\n  return [valActual, setValActual];\r\n}\r\n\r\nexport function createInterps(obj_name, scen_name, data, maxDelivs) {\r\n  const delivs =\r\n    data[obj_name][SCENARIO_KEY_STRING][scen_name][DELIV_KEY_STRING];\r\n  return d3\r\n    .scaleLinear()\r\n    .domain(ticksExact(0, 1, delivs.length))\r\n    .range(delivs.map((v) => Math.min(1, v / maxDelivs)))\r\n    .clamp(true);\r\n}\r\n\r\nexport function criteriaSort(criteria, data, objective) {\r\n  if (criteria === \"median\") {\r\n    return Object.keys(data[objective][SCENARIO_KEY_STRING]).sort(\r\n      (a, b) =>\r\n        d3.mean(data[objective][SCENARIO_KEY_STRING][a][DELIV_KEY_STRING]) -\r\n        d3.mean(data[objective][SCENARIO_KEY_STRING][b][DELIV_KEY_STRING])\r\n    );\r\n  }\r\n  if (criteria === \"deliveries\") {\r\n    return Object.keys(data[objective][SCENARIO_KEY_STRING]).sort(\r\n      (a, b) =>\r\n        d3.max(data[objective][SCENARIO_KEY_STRING][a][DELIV_KEY_STRING]) -\r\n        d3.max(data[objective][SCENARIO_KEY_STRING][b][DELIV_KEY_STRING])\r\n    );\r\n  }\r\n  if (criteria === \"alphabetical\") {\r\n    return Object.keys(data[objective][SCENARIO_KEY_STRING]).sort();\r\n  }\r\n}\r\n\r\nfunction get(object, path, defaultValue) {\r\n  const parts = path.split(\".\");\r\n  for (let part of parts) {\r\n    if (!object) return defaultValue;\r\n    object = object[part];\r\n  }\r\n  return object ?? defaultValue;\r\n}\r\n\r\nfunction pick(fn) {\r\n  return typeof fn === \"string\" ? (v) => get(v, fn) : fn;\r\n}\r\n\r\nexport function sortBy(array, fn) {\r\n  fn = pick(fn);\r\n  return array.sort((a, b) => {\r\n    const va = fn(a);\r\n    const vb = fn(b);\r\n    if (va < vb) return -1;\r\n    if (va > vb) return 1;\r\n    return 0;\r\n  });\r\n}\r\n\r\nexport function toRadians(a) {\r\n  return (a * Math.PI) / 180;\r\n}\r\n\r\nexport class Camera {\r\n  fov;\r\n  near;\r\n  far;\r\n  width;\r\n  height;\r\n  camera;\r\n  zoom;\r\n  view;\r\n  curTransform;\r\n\r\n  constructor({ fov, near, far, width, height, domElement, zoomFn }) {\r\n    this.fov = fov;\r\n    this.near = near;\r\n    this.far = far;\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      fov,\r\n      width / height,\r\n      near,\r\n      far + 1\r\n    );\r\n\r\n    this.camera.position.set(0, 0, this.far);\r\n\r\n    this.zoom = d3\r\n      .zoom()\r\n      .scaleExtent([\r\n        this.getScaleFromZ(this.far),\r\n        this.getScaleFromZ(this.near),\r\n      ])\r\n      .on(\"zoom\", (e) => {\r\n        this.d3ZoomHandler(e);\r\n        this.curTransform = e.transform;\r\n\r\n        zoomFn && zoomFn(e);\r\n      });\r\n\r\n    this.view = d3.select(domElement);\r\n    this.view.call(this.zoom);\r\n    this.zoom.transform(\r\n      this.view,\r\n      d3.zoomIdentity\r\n        .translate(this.width / 2, this.height / 2)\r\n        .scale(this.getScaleFromZ(this.far))\r\n    );\r\n  }\r\n\r\n  d3ZoomHandler(e) {\r\n    const scale = e.transform.k;\r\n    const x = -(e.transform.x - this.width / 2) / scale;\r\n    const y = (e.transform.y - this.height / 2) / scale;\r\n    const z = this.getZFromScale(scale);\r\n    this.camera.position.set(x, y, z);\r\n  }\r\n\r\n  getScaleFromZ(camera_z_position) {\r\n    const half_fov = this.fov / 2;\r\n    const half_fov_radians = toRadians(half_fov);\r\n    const half_fov_height = Math.tan(half_fov_radians) * camera_z_position;\r\n    const fov_height = half_fov_height * 2;\r\n    const scale = this.height / fov_height;\r\n    return scale;\r\n  }\r\n\r\n  getZFromScale(scale) {\r\n    const half_fov = this.fov / 2;\r\n    const half_fov_radians = toRadians(half_fov);\r\n    const scale_height = this.height / scale;\r\n    const camera_z_position = scale_height / (2 * Math.tan(half_fov_radians));\r\n    return camera_z_position;\r\n  }\r\n}\r\n\r\nexport class MeshGeometry {\r\n  threeGeom = new THREE.Geometry();\r\n  idx = 0;\r\n\r\n  addMeshCoords(meshCoords, transform, color, z = 0) {\r\n    const indices = [];\r\n\r\n    for (let j = 0; j < meshCoords.length; j++) {\r\n      const [v1, v2, v3] = meshCoords[j];\r\n\r\n      const a = new THREE.Vector3(transform.x + v1[0], transform.y - v1[1], z);\r\n      const b = new THREE.Vector3(transform.x + v2[0], transform.y - v2[1], z);\r\n      const c = new THREE.Vector3(transform.x + v3[0], transform.y - v3[1], z);\r\n      this.threeGeom.vertices.push(a, b, c);\r\n\r\n      const face = new THREE.Face3(\r\n        this.idx * 3 + 0,\r\n        this.idx * 3 + 1,\r\n        this.idx * 3 + 2\r\n      );\r\n\r\n      if (color) {\r\n        face.vertexColors.push(color);\r\n        face.vertexColors.push(color);\r\n        face.vertexColors.push(color);\r\n      }\r\n\r\n      this.threeGeom.faces.push(face);\r\n\r\n      indices.push(this.idx++);\r\n    }\r\n\r\n    return indices;\r\n  }\r\n}\r\n\r\nexport function mouseToThree(mouseX, mouseY, width, height) {\r\n  return new THREE.Vector3(\r\n    (mouseX / width) * 2 - 1,\r\n    -(mouseY / height) * 2 + 1,\r\n    1\r\n  );\r\n}\r\n\r\nexport function useStateRef(val) {\r\n  const [state, _setState] = useState(val);\r\n  const stateRef = useRef(val);\r\n\r\n  useEffect(() => void (stateRef.current = state), [state]);\r\n\r\n  const setState = useCallback((v) => {\r\n    _setState((stateRef.current = v));\r\n  }, []);\r\n\r\n  return [state, setState, stateRef];\r\n}\r\n"],"names":["DEFAULT_SCENARIO","DEFAULT_OBJECTIVE","DATE_START","ExplanationAnimApp","curObjective","setCurObjective","useState","slide","setSlide","lastSlide","useRef","slideFns","svgElement","bucketInterper","setBucketInterper","d3","width","height","margin","useLayoutEffect","svgContainer","current","selectAll","remove","document","querySelector","style","display","svgGroup","attr","append","concat","dataDescending","objectivesData","SCENARIO_KEY_STRING","DELIV_KEY_STRING_UNORD","map","val","placeFromLeft","year","sort","a","b","domain","ticksExact","length","range","DELIV_KEY_STRING","v","MAX_DELIVS","clamp","x","_ref","padding","y","xaxis","tickSize","tickValues","filter","_","i","call","data","d","join","bandwidth","transition","duration","delay","async","select","tickFormat","bars","end","finalWidth","interpolateWatercolorBlue","handleClick","p","node","addEventListener","removeEventListener","useEffect","_jsxs","className","children","_jsx","value","onChange","e","target","objectiveIDs","objectiveID","ref","BucketGlyph","levelInterp","DEGREE_SWAY","LEVELS","LINE_WIDTH","colorInterp","resolution","id","useId","svgSelector","liquidLevels","useMemo","prevLiquidLevels","usePrevious","innerWidth","innerHeight","bucketPath","split","liquids","ease","period","attrTween","diff","Math","abs","t","sin","min","PI","start","stop","count","filled","arguments","undefined","taper","bottomRight","bottomLeft","lineFunc","quantileBins","numericBins","unitsPerQuantile","maxQuantiles","bin","round","sum","Infinity","isEqualFunc","prev","objs","fetch","json","obj","scen","unord","max","Array","from","mapBy","name","console","log","_ref2","Object","keys","scenarioIDs","values","fn","newObjs","groupBy","key","WATERDROP_ICON","draw","context","size","moveTo","lineTo","arc","SQRT2","closePath","DROPLET_SHAPE","CIRC_RAD","SQRT1_2","DROP_RAD","CIRC_HEIGHT","DROP_HEIGHT","HAT_START","yToHalfWidth","trigX","angle","acos","yToSpriteY","spriteYToY","sy","waterdropDeltaOutline","yStart","yEnd","rad","Y_DELTA","rightCoords","leftCoords","dx1","dy1","dx2","dy2","ceil","v1","v2","v3","v4","push","reverse","waterdropDelta","coords","kernelDensityEstimator","kernel","X","V","kernelEpanechnikov","k","generateWaterdrop","delta","outer","cos","generateRandoPoints","shape","bounds","Matter","create","minX","maxX","minY","maxY","genX","genY","points","random","contains","WATERDROP_CAGE_COORDS","inner","RANDO_CACHE","lastNodesLen","DET_CACHE","lastDetNodesLen","radsToDropWidth","nodes","AREA","r","floor","sqrt","placeDropsUsingPhysics","reuse","WIDTH_AREA","randoPoints","Engine","Bodies","Composite","engine","nodePos","node_bodies","_ref3","nx","ny","circle","restitution","parts","quad","position","centre","vertices","isStatic","cage","setParts","setCentre","scale","add","world","FPS","SECS","update","retVal","_ref4","useStickyScale","defaultVal","setVal","useCallback","createInterps","obj_name","scen_name","maxDelivs","delivs","criteriaSort","criteria","objective","toRadians","Camera","constructor","_ref5","fov","near","far","domElement","zoomFn","this","camera","THREE","set","zoom","scaleExtent","getScaleFromZ","on","d3ZoomHandler","curTransform","transform","view","translate","z","getZFromScale","camera_z_position","half_fov_radians","fov_height","tan","MeshGeometry","threeGeom","idx","addMeshCoords","meshCoords","color","indices","j","c","face","vertexColors","faces","useStateRef","state","_setState","stateRef","setState"],"sourceRoot":""}